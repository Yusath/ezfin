import{a as Xt,b as ea,g as yt,r as m,u as wt,L as ce,d as He,H as ta,e as aa,f as ue,h as sa,N as ra,R as na}from"./vendor-react-BIDjS-Aj.js";import{H as kt,a as jt,P as be,b as Ke,S as Ye,X as ye,M as We,c as oa,C as ia,I as la,A as Je,d as Nt,T as Fe,e as st,f as da,W as ca,R as ga,L as ma,g as Ge,h as xa,U as vt,i as ha,j as pe,k as St,G as ua,l as qe,B as Ct,D as rt,m as nt,n as ot,o as pa,p as fa,q as ba,r as it,s as ya,t as wa,u as ka,v as Ue,F as Ie,w as ja,x as Na,y as va,z as Sa,E as Ca,K as Ia,J as lt,N as dt,O as Ea,Q as ct,V as Aa,Y as Ta,Z as Da,_ as Fa}from"./vendor-icons-DKL7OqTF.js";import{R as It,A as Ra,C as Pa,X as za,T as Et,a as Oa,P as _a,b as Ua,c as $a}from"./vendor-charts-DxPZeJcg.js";import{r as Ma}from"./vendor-excel-BWkK_84m.js";import{E as La,a as gt}from"./vendor-pdf-BRq4IfPl.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var $e={exports:{}},je={};var mt;function Ga(){if(mt)return je;mt=1;var a=Xt(),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,n=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(l,y,p){var f,I={},S=null,k=null;p!==void 0&&(S=""+p),y.key!==void 0&&(S=""+y.key),y.ref!==void 0&&(k=y.ref);for(f in y)t.call(y,f)&&!o.hasOwnProperty(f)&&(I[f]=y[f]);if(l&&l.defaultProps)for(f in y=l.defaultProps,y)I[f]===void 0&&(I[f]=y[f]);return{$$typeof:s,type:l,key:S,ref:k,props:I,_owner:n.current}}return je.Fragment=r,je.jsx=i,je.jsxs=i,je}var xt;function qa(){return xt||(xt=1,$e.exports=Ga()),$e.exports}var e=qa(),Ee={},ht;function Ba(){if(ht)return Ee;ht=1;var a=ea();return Ee.createRoot=a.createRoot,Ee.hydrateRoot=a.hydrateRoot,Ee}var Ha=Ba();const Ka=yt(Ha),ut=[{id:"1",name:"Makanan",icon:"ðŸ”",type:"expense"},{id:"2",name:"Transportasi",icon:"ðŸšŒ",type:"expense"},{id:"3",name:"Hiburan",icon:"ðŸŽ¬",type:"expense"},{id:"4",name:"Pendidikan",icon:"ðŸ“š",type:"expense"},{id:"5",name:"Belanja",icon:"ðŸ›ï¸",type:"expense"},{id:"6",name:"Uang Saku",icon:"ðŸ’¸",type:"income"},{id:"7",name:"Freelance",icon:"ðŸ’»",type:"income"}],pt={name:"Orang Pintar",avatarUrl:"https://ui-avatars.com/api/?name=Orang+Pintar&background=007AFF&color=ffffff&size=128&bold=true",pin:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92"},Be=[{id:"blue",name:"Default Blue",hex:"#007AFF"},{id:"purple",name:"Royal Purple",hex:"#AF52DE"},{id:"green",name:"Fresh Green",hex:"#34C759"},{id:"orange",name:"Sunset Orange",hex:"#FF9500"},{id:"pink",name:"Hot Pink",hex:"#FF2D55"},{id:"teal",name:"Ocean Teal",hex:"#30B0C7"},{id:"indigo",name:"Indigo",hex:"#5856D6"},{id:"red",name:"Red",hex:"#FF3B30"}],Ya="EZFinDB",Wa=1,_={TRANSACTIONS:"transactions",USER:"user",CATEGORIES:"categories"};class Ja{db=null;open(){return new Promise((s,r)=>{if(this.db){s(this.db);return}const t=indexedDB.open(Ya,Wa);t.onupgradeneeded=n=>{const o=n.target.result;o.objectStoreNames.contains(_.TRANSACTIONS)||o.createObjectStore(_.TRANSACTIONS,{keyPath:"id"}),o.objectStoreNames.contains(_.USER)||o.createObjectStore(_.USER,{keyPath:"key"}),o.objectStoreNames.contains(_.CATEGORIES)||o.createObjectStore(_.CATEGORIES,{keyPath:"id"})},t.onsuccess=n=>{this.db=n.target.result,s(this.db)},t.onerror=n=>{console.error("IndexedDB error:",n.target.error),r(n.target.error)}})}async getUser(){const s=await this.open();return new Promise((r,t)=>{const i=s.transaction(_.USER,"readonly").objectStore(_.USER).get("profile");i.onsuccess=()=>{r(i.result?i.result.data:null)},i.onerror=()=>t(i.error)})}async saveUser(s){const r=await this.open();return new Promise((t,n)=>{const l=r.transaction(_.USER,"readwrite").objectStore(_.USER).put({key:"profile",data:s});l.onsuccess=()=>t(),l.onerror=()=>n(l.error)})}async getAllTransactions(){const s=await this.open();return new Promise((r,t)=>{const i=s.transaction(_.TRANSACTIONS,"readonly").objectStore(_.TRANSACTIONS).getAll();i.onsuccess=()=>r(i.result||[]),i.onerror=()=>t(i.error)})}async addTransaction(s){const r=await this.open();return new Promise((t,n)=>{const l=r.transaction(_.TRANSACTIONS,"readwrite").objectStore(_.TRANSACTIONS).put(s);l.onsuccess=()=>t(),l.onerror=()=>n(l.error)})}async bulkAddTransactions(s){const r=await this.open();return new Promise((t,n)=>{const o=r.transaction(_.TRANSACTIONS,"readwrite"),i=o.objectStore(_.TRANSACTIONS);s.forEach(l=>{i.put(l)}),o.oncomplete=()=>t(),o.onerror=()=>n(o.error)})}async bulkDeleteTransactions(s){const r=await this.open();return new Promise((t,n)=>{const o=r.transaction(_.TRANSACTIONS,"readwrite"),i=o.objectStore(_.TRANSACTIONS);s.forEach(l=>{i.delete(l)}),o.oncomplete=()=>t(),o.onerror=()=>n(o.error)})}async clearAllTransactions(){const s=await this.open();return new Promise((r,t)=>{const i=s.transaction(_.TRANSACTIONS,"readwrite").objectStore(_.TRANSACTIONS).clear();i.onsuccess=()=>r(),i.onerror=()=>t(i.error)})}async getAllCategories(){const s=await this.open();return new Promise((r,t)=>{const i=s.transaction(_.CATEGORIES,"readonly").objectStore(_.CATEGORIES).getAll();i.onsuccess=()=>r(i.result||[]),i.onerror=()=>t(i.error)})}async saveCategory(s){const r=await this.open();return new Promise((t,n)=>{const l=r.transaction(_.CATEGORIES,"readwrite").objectStore(_.CATEGORIES).put(s);l.onsuccess=()=>t(),l.onerror=()=>n(l.error)})}async deleteCategory(s){const r=await this.open();return new Promise((t,n)=>{const l=r.transaction(_.CATEGORIES,"readwrite").objectStore(_.CATEGORIES).delete(s);l.onsuccess=()=>t(),l.onerror=()=>n(l.error)})}async initDefaultsIfNeeded(s){const r=await this.open();let t=await this.getAllCategories();if(t.length===0){const i=r.transaction(_.CATEGORIES,"readwrite").objectStore(_.CATEGORIES);ut.forEach(l=>i.put(l)),t=ut}let n=await this.getUser();return n||(await this.saveUser(s),n=s),{user:n,categories:t}}}const Y=new Ja,Za={en:{"nav.dashboard":"Dashboard","nav.history":"History","nav.stats":"Statistics","nav.settings":"Settings","nav.add":"New Transaction","dash.welcome":"Welcome back","dash.balance":"Total Balance","dash.income":"Income","dash.expense":"Expense","dash.quickSum":"Quick Summary","dash.txMonth":"Transactions This Month","dash.avgSpend":"Avg. Daily Spend","dash.analytics":"Analytics","dash.recent":"Recent Transactions","dash.viewAll":"View All","dash.noTx":"No transactions yet.","dash.profile":"Profile","dash.connect":"Connect Cloud","add.title":"New Transaction","add.scan":"Scan Receipt","add.scan.ai":"AI Powered Accuracy","add.scan.offline":"Offline Mode Active","add.store":"Store Name","add.items":"Items","add.addItem":"Add Item","add.date":"Date","add.category":"Category","add.total":"Total","add.save":"Save Transaction","add.saving":"Saving...","add.expense":"Expense","add.income":"Income","hist.title":"History","hist.search":"Search transactions...","hist.filter.all":"All","hist.noFound":"No transactions found","stats.title":"Financial Analysis","stats.dist":"Expense Distribution","stats.details":"Category Details","stats.advisor.btn":"AI Advisor","stats.advisor.desc":"Ask for smart saving tips","stats.noData":"No expense data yet.","set.title":"Settings","set.export":"Export Data","set.export.desc":"Download to Excel, PDF or Docx","set.google":"Google Account","set.backup":"Backup & Sync","set.backup.desc":"Sign in to access Drive backup features.","set.signin":"Sign In to Continue","set.sheet":"Target Spreadsheet","set.sync":"Sync & Import from Cloud","set.pref":"Preferences","set.lang":"Language","set.dark":"Dark Mode","set.online":"Online AI Scan","set.online.desc":"Use Cloud AI for better accuracy","set.cats":"Categories","set.sec":"Security","set.pin":"Change PIN","set.updatePin":"Update PIN","set.logout":"Disconnect","set.folder":"Destination Folder (Optional)","set.searchFolder":"Search Drive Folder...","common.cancel":"Cancel","common.confirm":"Confirm","common.success":"Success","common.error":"Error"},id:{"nav.dashboard":"Beranda","nav.history":"Riwayat","nav.stats":"Statistik","nav.settings":"Pengaturan","nav.add":"Transaksi Baru","dash.welcome":"Selamat datang","dash.balance":"Total Saldo","dash.income":"Pemasukan","dash.expense":"Pengeluaran","dash.quickSum":"Ringkasan Cepat","dash.txMonth":"Transaksi Bulan Ini","dash.avgSpend":"Rata-rata Harian","dash.analytics":"Analisis","dash.recent":"Transaksi Terakhir","dash.viewAll":"Lihat Semua","dash.noTx":"Belum ada transaksi.","dash.profile":"Profil","dash.connect":"Hubungkan Cloud","add.title":"Tambah Transaksi","add.scan":"Scan Struk","add.scan.ai":"Akurasi Tinggi (AI)","add.scan.offline":"Mode Offline Aktif","add.store":"Nama Toko","add.items":"Item Belanja","add.addItem":"Tambah Item","add.date":"Tanggal","add.category":"Kategori","add.total":"Total","add.save":"Simpan Transaksi","add.saving":"Menyimpan...","add.expense":"Pengeluaran","add.income":"Pemasukan","hist.title":"Riwayat","hist.search":"Cari transaksi...","hist.filter.all":"Semua","hist.noFound":"Transaksi tidak ditemukan","stats.title":"Analisis Keuangan","stats.dist":"Distribusi Pengeluaran","stats.details":"Rincian Kategori","stats.advisor.btn":"Asisten AI","stats.advisor.desc":"Minta saran penghematan cerdas","stats.noData":"Belum ada data pengeluaran.","set.title":"Pengaturan","set.export":"Ekspor Data","set.export.desc":"Unduh ke Excel, PDF atau Docx","set.google":"Akun Google","set.backup":"Backup & Sinkronisasi","set.backup.desc":"Masuk untuk fitur backup ke Drive.","set.signin":"Masuk dengan Google","set.sheet":"Spreadsheet Target","set.sync":"Sinkron & Impor dari Cloud","set.pref":"Preferensi","set.lang":"Bahasa","set.dark":"Mode Gelap","set.online":"Scan AI Online","set.online.desc":"Gunakan Cloud AI untuk hasil akurat","set.cats":"Kategori","set.sec":"Keamanan","set.pin":"Ganti PIN","set.updatePin":"Perbarui PIN","set.logout":"Putuskan Akun","set.folder":"Folder Tujuan (Opsional)","set.searchFolder":"Cari Folder Drive...","common.cancel":"Batal","common.confirm":"Konfirmasi","common.success":"Berhasil","common.error":"Gagal"}},At=m.createContext(void 0),Va=({children:a})=>{const[s,r]=m.useState("id");m.useEffect(()=>{const o=localStorage.getItem("app_language");o&&r(o)},[]);const t=o=>{r(o),localStorage.setItem("app_language",o)},n=o=>Za[s][o]||o;return e.jsx(At.Provider,{value:{language:s,setLanguage:t,t:n},children:a})},ge=()=>{const a=m.useContext(At);if(!a)throw new Error("useLanguage must be used within a LanguageProvider");return a},Qa=()=>{const a=wt(),s=n=>a.pathname===n,{t:r}=ge(),t=({to:n,icon:o,label:i,active:l})=>e.jsxs(ce,{to:n,className:`flex flex-col items-center justify-center w-full gap-1 pt-2 pb-1 transition-all duration-300 active:scale-90 ${l?"text-primary":"text-gray-600 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(o,{size:22,strokeWidth:l?2.5:2,className:l?"drop-shadow-sm":""}),e.jsx("span",{className:`text-[10px] font-medium tracking-tight ${l?"font-bold":""}`,children:i})]});return e.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 z-50 md:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-white/95 dark:bg-[#1C1C1E]/95 backdrop-blur-xl border-t-[0.5px] border-gray-200 dark:border-white/10 shadow-[0_-5px_20px_rgba(0,0,0,0.03)]"}),e.jsxs("div",{className:"relative flex justify-between items-end w-full px-2 pt-2",style:{paddingBottom:"calc(env(safe-area-inset-bottom) + 8px)"},children:[e.jsxs("div",{className:"flex-1 flex justify-evenly",children:[e.jsx(t,{to:"/",icon:kt,label:r("nav.dashboard"),active:s("/")}),e.jsx(t,{to:"/history",icon:jt,label:r("nav.history"),active:s("/history")})]}),e.jsx("div",{className:"relative w-14 -top-5 flex justify-center z-10 shrink-0",children:e.jsx(ce,{to:"/add","aria-label":"Add Transaction",className:"flex items-center justify-center w-12 h-12 rounded-full bg-gradient-to-tr from-primary to-blue-500 text-white shadow-lg shadow-blue-500/40 border-4 border-[#F2F2F7] dark:border-[#000000] transform transition-all active:scale-90 hover:-translate-y-1",children:e.jsx(be,{size:24,strokeWidth:3})})}),e.jsxs("div",{className:"flex-1 flex justify-evenly",children:[e.jsx(t,{to:"/stats",icon:Ke,label:r("nav.stats"),active:s("/stats")}),e.jsx(t,{to:"/settings",icon:Ye,label:r("nav.settings"),active:s("/settings")})]})]})]})},Tt=({onClose:a})=>e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-ios-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] w-full max-w-sm rounded-[2rem] p-6 shadow-2xl relative animate-ios-slide-up border border-gray-100 dark:border-white/10",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition-colors text-gray-400 dark:text-gray-500 ios-touch-target",children:e.jsx(ye,{size:20})}),e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4 pt-4",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-50 dark:bg-orange-900/20 rounded-[1.5rem] flex items-center justify-center text-orange-500 mb-2 shadow-sm border border-orange-100 dark:border-orange-500/20",children:e.jsx(We,{size:32,strokeWidth:1.5})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-extrabold text-gray-900 dark:text-white tracking-tight",children:"Kirim Masukan"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed mt-2 font-medium",children:["Punya ide fitur baru atau menemukan bug?",e.jsx("br",{}),"Bantu kami membuat EZFin lebih baik!"]})]}),e.jsxs("a",{href:"mailto:yusath.official@gmail.com?subject=Feedback%20EZFin%20AutoMate",target:"_blank",rel:"noopener noreferrer",className:"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3.5 rounded-2xl font-bold shadow-lg shadow-orange-500/30 flex items-center justify-center gap-2 transition-all active:scale-95 mt-2 hover:opacity-90",children:[e.jsx(oa,{size:18}),e.jsx("span",{children:"Kirim via Gmail"})]})]})]})}),Xa=()=>{const[a,s]=m.useState(!1),r=wt(),t=i=>r.pathname===i,{t:n}=ge(),o=({to:i,icon:l,label:y})=>e.jsxs(ce,{to:i,className:`flex items-center gap-3 px-4 py-2.5 rounded-xl transition-all duration-200 group ${t(i)?"bg-primary text-white shadow-lg shadow-blue-500/30":"text-gray-600 hover:bg-gray-100 dark:hover:bg-white/10 dark:text-gray-400"}`,children:[e.jsx(l,{size:18,className:t(i)?"":"group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"font-semibold text-xs tracking-wide",children:y})]});return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"w-64 h-full bg-white dark:bg-[#1C1C1E] border-r border-gray-200 dark:border-white/10 flex flex-col p-5 shadow-xl z-30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8 px-2",children:[e.jsx("img",{src:"https://i.ibb.co.com/KcRpsp15/Untitled-design.png",alt:"EZFin Logo",className:"w-10 h-10 rounded-xl shadow-md object-cover"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold tracking-tight text-gray-900 dark:text-white",children:"EZFin"}),e.jsx("p",{className:"text-[8px] font-medium text-gray-600 dark:text-gray-400 uppercase tracking-widest",children:"AutoMate"})]})]}),e.jsxs("nav",{className:"flex-1 space-y-1.5",children:[e.jsx(o,{to:"/",icon:kt,label:n("nav.dashboard")}),e.jsx(o,{to:"/history",icon:jt,label:n("nav.history")}),e.jsx(o,{to:"/stats",icon:Ke,label:n("nav.stats")}),e.jsx(o,{to:"/settings",icon:Ye,label:n("nav.settings")})]}),e.jsxs("div",{className:"mt-auto pt-6 space-y-3",children:[e.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-3 px-4 py-2.5 w-full rounded-xl transition-all duration-200 group border border-orange-400 text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/10 active:scale-95 bg-transparent",children:[e.jsx(We,{size:18,className:"group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"font-semibold text-xs tracking-wide",children:"Masukan & Saran"})]}),e.jsxs(ce,{to:"/add",className:"flex items-center justify-center gap-2 w-full bg-black dark:bg-white dark:text-black text-white py-3 rounded-2xl font-bold shadow-lg active:scale-95 transition-all hover:opacity-90 text-sm",children:[e.jsx(be,{size:18}),e.jsx("span",{children:n("nav.add")})]})]})]}),a&&e.jsx(Tt,{onClose:()=>s(!1)})]})};async function fe(a){const s=new TextEncoder().encode(a),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}function Ne(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}const es=({correctPin:a,onSuccess:s})=>{const[r,t]=m.useState(""),[n,o]=m.useState(!1),i=m.useRef(null),[l,y]=m.useState(!1);m.useEffect(()=>{const I=setTimeout(()=>{i.current?.focus()},100);return()=>clearTimeout(I)},[]);const p=async I=>{const S=I.target.value;S&&!/^\d+$/.test(S)||(t(S),S.length===6&&(y(!0),await fe(S)===a||S===a?setTimeout(()=>{s()},100):(y(!1),o(!0),navigator.vibrate&&navigator.vibrate(200),setTimeout(()=>{t(""),o(!1)},500))))},f=()=>{i.current?.focus()};return e.jsxs("main",{className:"fixed inset-0 bg-blue-600 dark:bg-black z-[100] flex flex-col items-center justify-center text-white p-6 animate-ios-fade-in",onClick:f,children:[e.jsxs("div",{className:"flex flex-col items-center mb-10 transition-all duration-500",children:[e.jsx("div",{className:"bg-white/20 p-5 rounded-[2rem] mb-6 backdrop-blur-xl shadow-lg border border-white/10",children:e.jsx("img",{src:"https://i.ibb.co.com/KcRpsp15/Untitled-design.png",alt:"Logo",className:"w-20 h-20 object-cover rounded-2xl drop-shadow-md"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:"EZFin AutoMate"}),e.jsx("p",{className:"text-white text-base font-medium",children:"Masukkan 6-digit PIN Anda"})]}),e.jsx("input",{ref:i,type:"tel",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,value:r,onChange:p,disabled:l,className:"absolute inset-0 w-full h-full opacity-0 cursor-default",autoFocus:!0,autoComplete:"off","aria-label":"PIN Entry"}),e.jsx("div",{className:`flex gap-6 mb-8 relative pointer-events-none ${n?"animate-shake":""}`,children:[...Array(6)].map((I,S)=>e.jsx("div",{className:`w-4 h-4 rounded-full transition-all duration-300 border border-white/30 ${S<r.length?"bg-white scale-125 shadow-[0_0_12px_rgba(255,255,255,0.8)] border-transparent":"bg-white/10 scale-100"}`},S))}),e.jsx("div",{className:"absolute bottom-10 text-white/90 text-xs font-medium uppercase tracking-widest animate-pulse pointer-events-none",children:"Build with â¤ï¸ by Yusathid"})]})},ts=({toasts:a,removeToast:s})=>e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-[999] flex flex-col gap-2 w-full max-w-sm px-4",children:a.map(r=>e.jsx(as,{toast:r,removeToast:s},r.id))}),as=({toast:a,removeToast:s})=>{m.useEffect(()=>{const n=a.action?6e3:3e3,o=setTimeout(()=>{s(a.id)},n);return()=>clearTimeout(o)},[a.id,a.action,s]);const r=()=>{switch(a.type){case"success":return"bg-secondary/95 text-white shadow-green-500/20";case"error":return"bg-accent/95 text-white shadow-red-500/20";default:return"bg-blue-500/95 text-white shadow-blue-500/20"}},t=()=>{switch(a.type){case"success":return e.jsx(Nt,{size:20});case"error":return e.jsx(Je,{size:20});default:return e.jsx(la,{size:20})}};return e.jsxs("div",{className:`pl-4 pr-3 py-3.5 rounded-2xl shadow-xl backdrop-blur-md flex items-center gap-3 text-sm font-medium animate-ios-fade-in ${r()} border border-white/10`,children:[e.jsx("div",{className:"shrink-0",children:t()}),e.jsx("div",{className:"flex-1 mr-2",children:e.jsx("p",{className:"leading-tight",children:a.message})}),a.action&&e.jsxs("button",{onClick:()=>{a.action?.onClick(),s(a.id)},className:"bg-white text-black px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap active:scale-95 transition-transform flex items-center gap-1 shadow-sm",children:[a.action.label,e.jsx(ia,{size:12,strokeWidth:3})]})]})};var ss={};const rs="28569786950-2lnehaar8vn0cueo4gpav84umuc30kc1.apps.googleusercontent.com",ve="ezfin_google_access_token";let Se=localStorage.getItem("GOOGLE_CLIENT_ID")||rs,ft=ss.GOOGLE_API_KEY||localStorage.getItem("GOOGLE_API_KEY")||"";const ns=["https://sheets.googleapis.com/$discovery/rest?version=v4","https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],os="https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file openid email profile";let de,J=null,Me=!1;const bt=a=>new Promise((s,r)=>{if(document.querySelector(`script[src="${a}"]`)){s();return}const t=document.createElement("script");t.src=a,t.async=!0,t.defer=!0,t.onload=()=>s(),t.onerror=n=>r(new Error(`Failed to load script: ${a}`)),document.body.appendChild(t)}),O={get isConfigured(){return!!Se},get hasValidSession(){return!!J},getToken:()=>J,updateCredentials:(a,s)=>{Se=a,localStorage.setItem("GOOGLE_CLIENT_ID",a),s&&(ft=s,localStorage.setItem("GOOGLE_API_KEY",s)),localStorage.removeItem(ve),J=null,Me=!1,de=void 0},initClient:async a=>{if(Me){a(!0);return}if(!Se){console.warn("Google Client ID is missing."),a(!1);return}try{if(await Promise.all([bt("https://apis.google.com/js/api.js"),bt("https://accounts.google.com/gsi/client")]),await new Promise((r,t)=>{if(!window.gapi)return t(new Error("GAPI not loaded"));window.gapi.load("client",{callback:r,onerror:t,timeout:5e3,ontimeout:t})}),await window.gapi.client.init({apiKey:ft,discoveryDocs:ns}),!window.google)throw new Error("Google Identity Services not loaded");de=window.google.accounts.oauth2.initTokenClient({client_id:Se,scope:os,callback:r=>{if(r.error!==void 0){console.error("Token Client Error:",r);return}J=r.access_token,localStorage.setItem(ve,r.access_token),window.gapi&&window.gapi.client&&window.gapi.client.setToken(r)}});const s=localStorage.getItem(ve);s&&(console.log("Restoring Google Session from LocalStorage..."),J=s,window.gapi&&window.gapi.client&&window.gapi.client.setToken({access_token:s})),Me=!0,a(!0)}catch(s){console.error("Failed to initialize Google Services",s),a(!1)}},signIn:()=>new Promise((a,s)=>{if(!Se)return s("Configuration Error: Missing Client ID");const r=()=>{if(!de)return s("Google Token Client not ready");de.callback,de.callback=t=>{t.error?s(t):(J=t.access_token,localStorage.setItem(ve,t.access_token),window.gapi&&window.gapi.client&&window.gapi.client.setToken(t),a(t.access_token))},de.requestAccessToken({prompt:"consent"})};de?r():O.initClient(t=>{if(!t)return s("Google API not initialized. Check Client ID.");r()})}),signOut:()=>{const a=window.gapi?.client?.getToken();if(a!==null)try{window.google?.accounts?.oauth2?.revoke(a.access_token,()=>{})}catch{console.warn("Revoke failed (token might be invalid already)")}window.gapi?.client?.setToken(null),localStorage.removeItem(ve),J=null},getUserInfo:async a=>{try{const s=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${a}`}});if(s.status===401)throw new Error("UNAUTHENTICATED");const r=await s.json();return{name:r.name,email:r.email,picture:r.picture}}catch(s){throw console.error("Failed to fetch user info",s),s}},searchFolders:async a=>{try{const s=`mimeType = 'application/vnd.google-apps.folder' and name contains '${a}' and trashed = false`;return(await window.gapi.client.drive.files.list({q:s,fields:"files(id, name)",spaces:"drive",pageSize:10})).result.files}catch(s){if(console.error("Folder search failed"),s?.result?.error?.code===401)throw new Error("UNAUTHENTICATED");return[]}},createSpreadsheet:async(a,s)=>{try{if(!J&&window.gapi?.client?.getToken()===null)throw new Error("No access token available. Please sign in.");const t=(await window.gapi.client.sheets.spreadsheets.create({resource:{properties:{title:a}}})).result.spreadsheetId;if(s){const i=(await window.gapi.client.drive.files.get({fileId:t,fields:"parents"})).result.parents.join(",");await window.gapi.client.drive.files.update({fileId:t,addParents:s,removeParents:i,fields:"id, parents"})}const n=[["ID","Date (ISO)","Store","Category","Type","Total Amount","Items Detail"]];return await window.gapi.client.sheets.spreadsheets.values.update({spreadsheetId:t,range:"Sheet1!A1",valueInputOption:"RAW",resource:{values:n}}),await window.gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:t,resource:{requests:[{repeatCell:{range:{sheetId:0,startRowIndex:0,endRowIndex:1},cell:{userEnteredFormat:{backgroundColor:{red:0,green:.48,blue:1},textFormat:{foregroundColor:{red:1,green:1,blue:1},bold:!0}}},fields:"userEnteredFormat(backgroundColor,textFormat)"}}]}}),{id:t,name:a}}catch(r){throw console.error("Error creating sheet"),r?.result?.error?.code===401?new Error("UNAUTHENTICATED"):r}},appendTransaction:async(a,s)=>{if(!J&&window.gapi?.client?.getToken()===null)throw console.warn("Skipping sync: No access token"),new Error("UNAUTHENTICATED");const r=s.items.map(n=>`${n.qty}x ${n.name} (@${n.price})`).join(", "),t=[s.id,s.date,s.storeName,s.category,s.type,s.totalAmount,r];try{await window.gapi.client.sheets.spreadsheets.values.append({spreadsheetId:a,range:"Sheet1!A1",valueInputOption:"USER_ENTERED",resource:{values:[t]}})}catch(n){throw console.error("Error appending row"),n?.result?.error?.code===401?new Error("UNAUTHENTICATED"):n}},updateTransaction:async(a,s)=>{if(!(!J&&window.gapi?.client?.getToken()===null))try{const t=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:a,range:"Sheet1!A2:A"})).result.values;if(!t)return;const n=t.findIndex(y=>y[0]===s.id);if(n===-1)return;const o=n+2,i=s.items.map(y=>`${y.qty}x ${y.name} (@${y.price})`).join(", "),l=[s.id,s.date,s.storeName,s.category,s.type,s.totalAmount,i];await window.gapi.client.sheets.spreadsheets.values.update({spreadsheetId:a,range:`Sheet1!A${o}:G${o}`,valueInputOption:"USER_ENTERED",resource:{values:[l]}})}catch(r){throw console.error("Update failed"),r?.result?.error?.code===401?new Error("UNAUTHENTICATED"):r}},bulkAppendTransactions:async(a,s)=>{if(!J&&window.gapi?.client?.getToken()===null)return;const r=s.map(t=>{const n=t.items.map(o=>`${o.qty}x ${o.name} (@${o.price})`).join(", ");return[t.id,t.date,t.storeName,t.category,t.type,t.totalAmount,n]});try{await window.gapi.client.sheets.spreadsheets.values.append({spreadsheetId:a,range:"Sheet1!A1",valueInputOption:"USER_ENTERED",resource:{values:r}})}catch(t){throw console.error("Error bulk appending"),t?.result?.error?.code===401?new Error("UNAUTHENTICATED"):t}},clearAllData:async a=>{if(!(!J&&window.gapi?.client?.getToken()===null))try{await window.gapi.client.sheets.spreadsheets.values.clear({spreadsheetId:a,range:"Sheet1!A2:Z10000"})}catch(s){throw console.error("Clear failed"),s?.result?.error?.code===401?new Error("UNAUTHENTICATED"):s}},searchSpreadsheets:async a=>{try{return(await window.gapi.client.drive.files.list({q:`mimeType='application/vnd.google-apps.spreadsheet' and name contains '${a}' and trashed=false`,fields:"files(id, name)",spaces:"drive"})).result.files}catch(s){if(console.error("Search failed"),s?.result?.error?.code===401)throw new Error("UNAUTHENTICATED");return[]}},fetchTransactions:async a=>{if(!J&&window.gapi?.client?.getToken()===null)throw new Error("Not logged in");try{const r=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:a,range:"Sheet1!A2:G"})).result.values;return!r||r.length===0?[]:r.map(t=>{const n=t[6]||"",o=[],i=/(\d+)x\s(.+?)\s\(@([\d.,]+)\)/g;let l;for(;(l=i.exec(n))!==null;){const y=l[3].replace(/[.,]/g,"");o.push({id:Math.random().toString(36).substr(2,9),qty:parseInt(l[1]),name:l[2],price:parseInt(y)||0})}return o.length===0&&n&&o.push({id:Math.random().toString(36).substr(2,9),name:n,qty:1,price:Number(t[5])||0}),{id:t[0],date:t[1],storeName:t[2],category:t[3],type:t[4],totalAmount:Number(t[5]),items:o}})}catch(s){throw console.error("Fetch transactions failed"),s?.result?.error?.code===401?new Error("UNAUTHENTICATED"):s}},deleteTransactions:async(a,s)=>{if(!(!J&&window.gapi?.client?.getToken()===null)&&s.length!==0)try{const t=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:a,range:"Sheet1!A2:A"})).result.values;if(!t||t.length===0)return;const n=new Set(s),o=[];if(t.forEach((l,y)=>{const p=l[0];n.has(p)&&o.push(y+1)}),o.length===0)return;o.sort((l,y)=>y-l);const i=o.map(l=>({deleteDimension:{range:{sheetId:0,dimension:"ROWS",startIndex:l,endIndex:l+1}}}));await window.gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:a,resource:{requests:i}})}catch(r){throw console.error("Error deleting transactions"),r?.result?.error?.code===401?new Error("UNAUTHENTICATED"):r}},ensureSettingsSheet:async a=>{try{(await window.gapi.client.sheets.spreadsheets.get({spreadsheetId:a,fields:"sheets.properties.title"})).result.sheets.some(t=>t.properties.title==="Settings")||(await window.gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:a,resource:{requests:[{addSheet:{properties:{title:"Settings",hidden:!0}}}]}}),await window.gapi.client.sheets.spreadsheets.values.update({spreadsheetId:a,range:"Settings!A1:D1",valueInputOption:"RAW",resource:{values:[["PIN","CATEGORIES","DARK_MODE","THEME_COLOR"]]}}))}catch(s){if(console.error("Failed to ensure settings sheet"),s?.result?.error?.code===401)throw new Error("UNAUTHENTICATED")}},saveAppSettings:async(a,s,r,t,n="blue")=>{try{await O.ensureSettingsSheet(a),await window.gapi.client.sheets.spreadsheets.values.update({spreadsheetId:a,range:"Settings!A2:D2",valueInputOption:"RAW",resource:{values:[[s,JSON.stringify(r),t.toString(),n]]}})}catch(o){if(console.error("Failed to save app settings"),o?.result?.error?.code===401)throw new Error("UNAUTHENTICATED")}},fetchAppSettings:async a=>{try{const r=(await window.gapi.client.sheets.spreadsheets.values.get({spreadsheetId:a,range:"Settings!A2:D2"})).result.values;if(!r||r.length===0)return null;let t=[];try{t=JSON.parse(r[0][1]||"[]")}catch{}let n=!1;r[0][2]&&(n=r[0][2]==="true");const o=r[0][3]||"blue";return{pin:r[0][0],categories:t,darkMode:n,themeColor:o}}catch(s){if(console.warn("Settings sheet missing or empty"),s?.result?.error?.code===401)throw new Error("UNAUTHENTICATED");return null}}},is=({user:a,transactions:s,onUpdateUser:r})=>{He();const{t}=ge(),[n,o]=m.useState("month"),[i,l]=m.useState(!1),[y,p]=m.useState(!1),[f,I]=m.useState(a.name),[S,k]=m.useState(a.avatarUrl),[x,b]=m.useState(!1);m.useEffect(()=>{I(a.name),k(a.avatarUrl)},[a]);const N=u=>{let C=Number(u.totalAmount);return(!C||isNaN(C)||C===0)&&u.items&&u.items.length>0&&(C=u.items.reduce((d,g)=>{const T=Number(g.qty)||0,j=Number(g.price)||0;return d+T*j},0)),Math.max(0,C||0)},v=u=>{if(!u)return null;const C=new Date(u);return isNaN(C.getTime())?null:C},U=s.filter(u=>u.type==="income").reduce((u,C)=>u+N(C),0),K=s.filter(u=>u.type==="expense").reduce((u,C)=>u+N(C),0),Z=U-K,F=new Date,A=(u,C)=>u.getFullYear()===C.getFullYear()&&u.getMonth()===C.getMonth(),R=s.filter(u=>{const C=v(u.date);return C&&A(C,F)});R.filter(u=>u.type==="income").reduce((u,C)=>u+N(C),0);const q=R.filter(u=>u.type==="expense").reduce((u,C)=>u+N(C),0),M=[...s].sort((u,C)=>{const d=v(u.date)?.getTime()||0;return(v(C.date)?.getTime()||0)-d}).slice(0,10),W=(()=>{const u=new Date;u.setHours(23,59,59,999);const C=s.filter($=>$.type==="expense");let d;const g=u;let T="day";n==="week"?(d=new Date,d.setDate(u.getDate()-6),d.setHours(0,0,0,0)):n==="month"?d=new Date(u.getFullYear(),u.getMonth(),1):(d=new Date(u.getFullYear(),0,1),T="month");const j=new Map,D=new Date(d);for(;D<=g;){let $=T==="day"?`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}-${String(D.getDate()).padStart(2,"0")}`:`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}`;j.set($,0),T==="day"?D.setDate(D.getDate()+1):D.setMonth(D.getMonth()+1)}return C.forEach($=>{const G=v($.date);if(G&&G>=d&&G<=g){let Q=T==="day"?`${G.getFullYear()}-${String(G.getMonth()+1).padStart(2,"0")}-${String(G.getDate()).padStart(2,"0")}`:`${G.getFullYear()}-${String(G.getMonth()+1).padStart(2,"0")}`;j.has(Q)&&j.set(Q,(j.get(Q)||0)+N($))}}),Array.from(j.entries()).map(([$,G])=>{const[Q,X,h]=$.split("-").map(Number);return{name:T==="day"?`${h}/${X}`:new Date(Q,X-1,1).toLocaleDateString("id-ID",{month:"short"}),amount:G}})})(),B=W.some(u=>u.amount>0),oe=()=>{r({name:f,avatarUrl:S}),l(!1)},V=()=>{const u=encodeURIComponent(f||"User"),C=["007AFF","34C759","FF9500","AF52DE","FF2D55","5856D6"],d=C[Math.floor(Math.random()*C.length)];k(`https://ui-avatars.com/api/?name=${u}&background=${d}&color=fff&size=128&bold=true`)},ie=async()=>{b(!0);try{const u=await O.signIn(),C=await O.getUserInfo(u);r({name:C.name,avatarUrl:C.picture,googleEmail:C.email,googlePhotoUrl:C.picture})}catch(u){console.error(u),alert("Failed to sign in with Google")}finally{b(!1)}},te=()=>{const u=new Date().getHours();return u<11?"Selamat Pagi":u<15?"Selamat Siang":u<19?"Selamat Sore":"Selamat Malam"};return e.jsxs("div",{className:"pt-safe md:px-0 space-y-6 md:space-y-8 page-transition pb-28 md:pb-10 w-full overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between pt-4 px-4 md:hidden",children:[e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-4 group ios-touch-target",children:[e.jsx("img",{src:a.avatarUrl,alt:"Profile",className:"w-10 h-10 rounded-full object-cover shadow-sm border-2 border-white dark:border-card-dark"}),e.jsxs("div",{className:"flex flex-col items-start text-left",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-400",children:te()}),e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white leading-tight",children:a.name.split(" ")[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>p(!0),"aria-label":"Feedback",className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 border border-orange-200 dark:border-orange-500/30 shadow-sm ios-touch-target hover:bg-orange-100 transition-all active:scale-95",children:[e.jsx(We,{size:14}),e.jsx("span",{className:"text-[10px] font-bold",children:"Saran & Masukan"})]}),e.jsx(ce,{to:"/settings","aria-label":"Settings",className:"w-9 h-9 flex items-center justify-center rounded-full bg-white dark:bg-white/10 shadow-sm text-gray-600 dark:text-gray-300 ios-touch-target",children:e.jsx(Ye,{size:18})})]})]}),e.jsxs("div",{className:"hidden md:flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold text-gray-900 dark:text-white",children:t("nav.dashboard")}),e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[t("dash.welcome"),", ",a.name," ðŸ‘‹"]})]}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-3 bg-card-light dark:bg-card-dark px-4 py-2 rounded-xl shadow-sm hover:shadow-md transition-all ios-touch-target",children:[e.jsx("img",{src:a.avatarUrl,alt:"Profile",className:"w-8 h-8 rounded-full"}),e.jsx("span",{className:"font-bold text-sm text-gray-700 dark:text-white",children:t("dash.profile")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-y-4 md:gap-6 w-full",children:[e.jsxs("div",{className:"md:col-span-8 w-full flex flex-col gap-6",children:[e.jsxs("div",{className:"w-full relative overflow-hidden rounded-b-[2rem] md:rounded-[2rem] p-6 md:p-8 shadow-ios shadow-blue-500/20 bg-gradient-to-br from-[#007AFF] to-[#5856D6] text-white ios-touch-target",children:[e.jsxs("div",{className:"relative z-10 flex flex-col items-center md:items-start text-center md:text-left",children:[e.jsx("span",{className:"text-blue-50 text-[10px] font-bold tracking-widest uppercase mb-1",children:t("dash.balance")}),e.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight mb-6 break-words max-w-full",children:["Rp ",Z.toLocaleString("id-ID")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:gap-4 w-full md:max-w-md",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-2xl p-3 md:p-4 flex flex-col items-center md:items-start border border-white/10 hover:bg-white/30 transition-colors min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 mb-1 justify-center md:justify-start w-full",children:[e.jsx("div",{className:"p-1 md:p-1.5 bg-white/20 rounded-full shrink-0",children:e.jsx(Fe,{size:10,className:"md:w-3 md:h-3 text-white"})}),e.jsx("span",{className:"text-[10px] text-white font-bold uppercase tracking-wider truncate",children:t("dash.income")})]}),e.jsxs("span",{className:"font-bold text-base md:text-lg truncate w-full",children:["Rp ",U.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-2xl p-3 md:p-4 flex flex-col items-center md:items-start border border-white/10 hover:bg-white/30 transition-colors min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 mb-1 justify-center md:justify-start w-full",children:[e.jsx("div",{className:"p-1 md:p-1.5 bg-white/20 rounded-full shrink-0",children:e.jsx(st,{size:10,className:"md:w-3 md:h-3 text-white"})}),e.jsx("span",{className:"text-[10px] text-white font-bold uppercase tracking-wider truncate",children:t("dash.expense")})]}),e.jsxs("span",{className:"font-bold text-base md:text-lg truncate w-full",children:["Rp ",K.toLocaleString("id-ID")]})]})]})]}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10 mix-blend-overlay"}),e.jsx("div",{className:"absolute -top-24 -right-24 w-64 h-64 bg-white/20 rounded-full blur-3xl pointer-events-none"})]}),e.jsxs(ce,{to:"/add",className:"hidden md:flex w-full bg-black dark:bg-white dark:text-black text-white py-4 rounded-[1.5rem] font-bold shadow-lg shadow-gray-200 dark:shadow-none hover:shadow-xl transition-all items-center justify-center gap-3 active:scale-[0.99] text-lg",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-1",children:e.jsx(be,{size:24,strokeWidth:3})}),e.jsx("span",{children:t("nav.add")})]})]}),e.jsx("div",{className:"col-span-12 md:col-span-4 flex flex-col h-full mx-4 md:mx-0",children:e.jsxs("div",{className:"bg-card-light dark:bg-card-dark rounded-[2rem] p-5 shadow-sm border border-gray-100 dark:border-white/5 h-full flex flex-col justify-center",children:[e.jsxs("h2",{className:"font-bold text-base mb-3 text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(da,{size:16,className:"text-primary"}),t("dash.quickSum")]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-1 gap-3 md:gap-3 h-full",children:[e.jsxs("div",{className:"flex flex-col justify-center items-center md:items-start p-3 bg-surface dark:bg-white/5 rounded-2xl md:flex-row md:justify-between",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 block mb-0.5",children:t("dash.txMonth")}),e.jsx("span",{className:"font-bold text-gray-900 dark:text-white text-xl md:text-lg",children:R.length})]}),e.jsx("div",{className:"hidden md:flex w-8 h-8 rounded-full bg-blue-100 dark:bg-white/10 items-center justify-center text-primary",children:e.jsx(Ke,{size:14})})]}),e.jsxs("div",{className:"flex flex-col justify-center items-center md:items-start p-3 bg-surface dark:bg-white/5 rounded-2xl md:flex-row md:justify-between",children:[e.jsxs("div",{className:"text-center md:text-left w-full",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 block mb-0.5",children:t("dash.avgSpend")}),e.jsxs("span",{className:"font-bold text-gray-900 dark:text-white text-base md:text-lg truncate block",children:["Rp ",Math.round((q||0)/(new Date().getDate()||1)).toLocaleString("id-ID",{notation:"compact"})]})]}),e.jsx("div",{className:"hidden md:flex w-8 h-8 rounded-full bg-orange-100 dark:bg-white/10 items-center justify-center text-orange-500",children:e.jsx(Fe,{size:14})})]})]})]})}),e.jsxs("div",{className:"col-span-12 md:col-span-8 space-y-4 mx-4 md:mx-0",children:[e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsx("h2",{className:"font-bold text-lg text-gray-900 dark:text-white",children:t("dash.analytics")}),e.jsx("div",{className:"flex bg-gray-200 dark:bg-white/10 rounded-lg p-0.5",children:["week","month","year"].map(u=>e.jsx("button",{onClick:()=>o(u),className:`px-3 py-1 text-[10px] font-bold rounded-md transition-all uppercase ios-touch-target ${n===u?"bg-card-light dark:bg-card-dark shadow-sm text-primary":"text-gray-700 dark:text-gray-400"}`,children:u},u))})]}),e.jsx("div",{className:"h-56 md:h-80 w-full bg-card-light dark:bg-card-dark rounded-[2rem] p-4 md:p-6 shadow-sm border border-gray-100 dark:border-white/5",children:B?e.jsx(It,{width:"100%",height:"100%",children:e.jsxs(Ra,{data:W,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorAmount",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#007AFF",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#007AFF",stopOpacity:0})]})}),e.jsx(Pa,{strokeDasharray:"3 3",vertical:!1,stroke:"#E5E7EB",opacity:.1}),e.jsx(za,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:10,fontWeight:600},dy:10}),e.jsx(Et,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:"12px",border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",backdropFilter:"blur(10px)",fontSize:"12px"},itemStyle:{color:"#007AFF",fontWeight:"bold"},cursor:{stroke:"#007AFF",strokeWidth:1},formatter:u=>`Rp ${Number(u).toLocaleString()}`}),e.jsx(Oa,{type:"monotone",dataKey:"amount",stroke:"#007AFF",strokeWidth:2,fillOpacity:1,fill:"url(#colorAmount)"})]})}):e.jsx("div",{className:"h-full flex flex-col items-center justify-center text-gray-500",children:e.jsx("p",{className:"text-xs font-medium",children:"No data available for this period"})})})]}),e.jsxs("div",{className:"col-span-12 md:col-span-4 md:row-span-2 flex flex-col h-full mx-4 md:mx-0",children:[e.jsxs("div",{className:"flex justify-between items-center px-2 mb-4",children:[e.jsx("h2",{className:"font-bold text-lg text-gray-900 dark:text-white",children:t("dash.recent")}),e.jsx(ce,{to:"/history",className:"text-xs text-primary font-bold hover:underline ios-touch-target",children:t("dash.viewAll")})]}),e.jsx("div",{className:"flex-1 bg-card-light dark:bg-card-dark rounded-[2rem] p-0 md:p-6 md:shadow-sm md:border md:border-gray-100 dark:md:border-white/5 overflow-hidden",children:e.jsx("div",{className:"space-y-3 h-full overflow-y-auto no-scrollbar md:pr-2 pb-4 md:pb-0",children:M.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-center rounded-3xl border border-dashed border-gray-200 dark:border-white/10 m-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-2",children:e.jsx(ca,{size:18,className:"text-gray-400"})}),e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:t("dash.noTx")})]}):M.map((u,C)=>{const d=N(u);return e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-card-dark md:bg-gray-50 md:dark:bg-white/5 p-3 rounded-2xl shadow-sm md:shadow-none ios-touch-target border border-gray-100 dark:border-white/5 md:border-transparent animate-slide-in-right group",style:{animationDelay:`${C*.05}s`},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center group-active:scale-95 transition-transform ${u.type==="income"?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400"}`,children:u.type==="income"?e.jsx(Fe,{size:16}):e.jsx(st,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-white text-xs md:text-sm line-clamp-1",children:u.storeName}),e.jsxs("div",{className:"flex gap-2 text-[10px] text-gray-600 dark:text-gray-400 mt-0.5 font-medium",children:[e.jsx("span",{children:v(u.date)?.toLocaleDateString("id-ID",{day:"numeric",month:"short"})}),u.items&&u.items.length>0&&e.jsxs("span",{children:["â€¢ ",u.items.length," Items"]})]})]})]}),e.jsxs("span",{className:`font-bold text-xs md:text-sm whitespace-nowrap ${u.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[u.type==="income"?"+":"-"," ",d.toLocaleString("id-ID",{notation:"compact"})]})]},u.id)})})})]})]}),i&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-sm animate-fade-in w-full",children:e.jsxs("div",{className:"bg-card-light dark:bg-card-dark w-full max-w-md rounded-t-[2rem] sm:rounded-[2rem] p-6 shadow-2xl animate-ios-slide-up max-h-[90vh] overflow-y-auto page-slide-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Account & Profile"}),e.jsx("button",{onClick:()=>l(!1),"aria-label":"Close profile",className:"p-2 bg-gray-100 dark:bg-white/10 rounded-full text-gray-500 hover:bg-gray-200 ios-touch-target",children:e.jsx(ye,{size:18})})]}),e.jsx("div",{className:"flex flex-col items-center mb-6",children:e.jsxs("div",{className:"relative cursor-pointer ios-touch-target",onClick:V,children:[e.jsx("img",{src:S,alt:"Avatar",className:"w-20 h-20 rounded-full border-4 border-gray-100 dark:border-white/10 bg-gray-50 object-cover"}),e.jsx("div",{className:"absolute bottom-0 right-0 bg-primary text-white p-1.5 rounded-full shadow-lg border-2 border-white dark:border-black",children:e.jsx(ga,{size:12})})]})}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-white/5 rounded-3xl border border-gray-100 dark:border-white/5",children:[e.jsx("h3",{className:"text-[10px] font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wide mb-3 flex items-center gap-2",children:t("set.backup")}),a.googleEmail?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.googlePhotoUrl||a.avatarUrl,className:"w-10 h-10 rounded-full border border-gray-200"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-green-500 p-0.5 rounded-full border-2 border-white",children:e.jsx(Nt,{size:10,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"font-bold text-sm text-gray-900 dark:text-white truncate",children:a.googleEmail}),e.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Connected"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 leading-relaxed",children:t("set.backup.desc")}),e.jsx("button",{onClick:ie,disabled:x,className:"w-full bg-card-light dark:bg-black border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white py-3 rounded-2xl font-bold shadow-sm flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors ios-touch-target text-sm",children:x?e.jsx("span",{className:"animate-pulse",children:"Connecting..."}):e.jsxs(e.Fragment,{children:[e.jsx(ma,{size:16}),t("set.signin")]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-700 dark:text-gray-300 uppercase ml-3 mb-1 block",children:"Display Name"}),e.jsx("input",{type:"text",value:f,onChange:u=>I(u.target.value),className:"w-full bg-gray-100 dark:bg-white/10 border-none rounded-2xl px-4 py-3 font-semibold text-gray-900 dark:text-white focus:ring-2 focus:ring-primary/50 text-sm",placeholder:"Nama Lengkap"})]}),e.jsx("button",{onClick:oe,className:"w-full bg-blue-600 text-white py-3.5 rounded-2xl font-bold text-base shadow-lg shadow-blue-500/30 ios-touch-target hover:bg-blue-700 active:scale-95 transition-all",children:"Save Changes"})]})]})}),y&&e.jsx(Tt,{onClose:()=>p(!1)})]})},Dt="ezfin_ai_config",ls=5*1024*1024,ds={baseUrl:"https://api.groq.com/openai/v1",apiKey:"",modelName:"llama-3.1-8b-instant"},Ft=()=>{const a=localStorage.getItem(Dt);return a?JSON.parse(a):ds},cs=a=>{localStorage.setItem(Dt,JSON.stringify(a))},gs=a=>new Promise((s,r)=>{if(a.size>ls){r(new Error("Ukuran file terlalu besar (Maks 5MB)"));return}if(!["image/jpeg","image/png","image/webp"].includes(a.type)){r(new Error("Format file tidak didukung. Gunakan JPG, PNG, atau WEBP."));return}const n=new FileReader;n.onload=()=>{const o=n.result;s(o)},n.onerror=r,n.readAsDataURL(a)}),Rt=async(a,s=!1)=>{const r=Ft(),t=r.apiKey;if(!t)throw new Error("MISSING_API_KEY");const n="https://api.groq.com/openai/v1/chat/completions",o={model:r.modelName||"llama-3.1-8b-instant",messages:a,temperature:.7};s&&(o.response_format={type:"json_object"});try{const i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(o)});if(!i.ok){const y=await i.text();throw new Error(`GROQ API Error (${i.status}): ${y}`)}return(await i.json()).choices[0]?.message?.content||""}catch(i){throw console.error("GROQ Service Error:",i),i.message==="MISSING_API_KEY"?i:new Error(i.message||"Gagal menghubungi GROQ AI Provider")}},ms=async(a,s)=>{try{const r=a.filter(p=>p.type==="income").reduce((p,f)=>p+f.totalAmount,0),t=a.filter(p=>p.type==="expense").reduce((p,f)=>p+f.totalAmount,0),n=a.filter(p=>p.type==="expense").slice(0,5).map(p=>`${p.storeName} (${p.category}): Rp ${p.totalAmount.toLocaleString()}`).join(", "),o="Anda adalah asisten keuangan pribadi yang bijak dan hemat. Berikan saran DALAM BAHASA INDONESIA yang sangat ringkas (maksimal 2 kalimat) dan gunakan emoji.",i=`
      User: ${s}
      Total Masuk: Rp ${r.toLocaleString()}
      Total Keluar: Rp ${t.toLocaleString()}
      Sisa: Rp ${(r-t).toLocaleString()}
      Pengeluaran Terakhir: ${n}
      
      Berikan komentar atau saran keuangan singkat berdasarkan data di atas.
    `;return await Rt([{role:"system",content:o},{role:"user",content:i}])||"Hemat pangkal kaya! ðŸŒ±"}catch{return console.error("Advice Error"),"Gagal memuat saran AI. Cek konfigurasi API Key."}},xs=async a=>{try{const s=await gs(a),o=(await Rt([{role:"system",content:`
      You are an expert Receipt Extraction Agent (Indonesian Context).
      Extract data into valid JSON.
      
      JSON SCHEMA:
      {
        "store_name": "String",
        "transaction_date": "YYYY-MM-DD",
        "items": [ { "name": "String", "qty": Number, "price": Number } ],
        "shipping_cost": Number,
        "service_fee": Number,
        "shipping_discount": Number,
        "voucher_discount": Number
      }
      
      RULES:
      1. Currency is IDR. Ignore thousands separators. "10.000" = 10000.
      2. Extract Discounts as POSITIVE numbers.
      3. If field not found, set to 0 or empty string.
      4. ONLY return raw JSON, no markdown blocks.
    `},{role:"user",content:[{type:"text",text:"Extract information from this receipt image."},{type:"image_url",image_url:{url:s}}]}],!0)).replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(o)}catch(s){throw s}},hs=async a=>{if(!window.Tesseract)throw new Error("Offline OCR engine not loaded.");return new Promise((s,r)=>{window.Tesseract.recognize(a,"eng+ind",{logger:t=>console.log(t)}).then(({data:{text:t}})=>{console.log("Offline OCR Result:",t);const n=/(?:Total|Jumlah|Bayar|Tagihan)[\D]*?(\d{1,3}(?:[.,]\d{3})*(?:[.,]\d{2})?)/i,o=t.match(n);let i=0;o&&(i=parseInt(o[1].replace(/[.,]/g,"")));const l=/(\d{2}[-/]\d{2}[-/]\d{4})|(\d{4}[-/]\d{2}[-/]\d{2})/,y=t.match(l);let p=new Date().toISOString().split("T")[0];if(y)try{p=new Date(y[0]).toISOString().split("T")[0]}catch{}const f=t.split(`
`).map(S=>S.trim()).filter(S=>S.length>3),I=f.length>0?f[0]:"Unknown Store";s({store_name:I,transaction_date:p,items:[{name:"Item Scan (Offline)",qty:1,price:i}],shipping_cost:0,service_fee:0,shipping_discount:0,voucher_discount:0})}).catch(t=>{r(t)})})},Pt=({categories:a,onSave:s,addToast:r,initialData:t})=>{const n=He(),{t:o}=ge(),i=m.useRef(null),l=m.useRef(null),y=()=>{const h=new Date,w=h.getFullYear(),P=String(h.getMonth()+1).padStart(2,"0"),z=String(h.getDate()).padStart(2,"0"),H=String(h.getHours()).padStart(2,"0"),ee=String(h.getMinutes()).padStart(2,"0");return`${w}-${P}-${z}T${H}:${ee}`},[p,f]=m.useState(t?.storeName||""),[I,S]=m.useState(t?.items||[{id:"init_1",name:"",qty:1,price:0}]),[k,x]=m.useState(t&&t.type==="income"?t.totalAmount.toString():""),[b,N]=m.useState(t?t.date.substring(0,16):y()),[v,U]=m.useState(t?.type||"expense"),[K,Z]=m.useState(""),[F,A]=m.useState(!1),[R,q]=m.useState(!1),[M,re]=m.useState("Connecting..."),[W,B]=m.useState(!1);m.useEffect(()=>{if(t){const h=a.find(w=>w.name===t.category&&w.type===t.type);if(h)Z(h.id);else{const w=a.find(P=>P.name===t.category);w&&Z(w.id)}}},[t,a]),m.useEffect(()=>{const h=a.find(w=>w.id===K);if(!h||h.type!==v){const w=a.find(P=>P.type===v);w&&Z(w.id)}},[v,a]);const V=v==="income"?Number(k)||0:I.reduce((h,w)=>{const P=Number(w.qty)||0,z=Number(w.price)||0;return h+P*z},0),ie=()=>{S([...I,{id:Math.random().toString(36).substring(7),name:"",qty:1,price:0}])},te=(h,w,P)=>{S(I.map(z=>{if(z.id!==h)return z;let H=P;if(w==="qty"||w==="price")if(P==="")H="";else{const ee=parseFloat(P);H=isNaN(ee)?0:ee}return{...z,[w]:H}}))},u=h=>{I.length>1?S(I.filter(w=>w.id!==h)):S([{id:Math.random().toString(36).substring(7),name:"",qty:1,price:0}])},C=async()=>{if(!p||v==="expense"&&I.length===0)return;A(!0);const h=a.find(H=>H.id===K),w=h?h.name:a.find(H=>H.type===v)?.name||"General",P=new Date(b).toISOString();let z=[];v==="income"?z=[{id:Math.random().toString(36).substring(7),name:p,qty:1,price:Number(k)||0}]:z=I.map(H=>({...H,qty:Number(H.qty)||0,price:Number(H.price)||0})),await s({id:t?t.id:Math.random().toString(36).substring(7),storeName:p.trim(),items:z,totalAmount:Number(V),date:P,category:w,type:v}),A(!1),n("/")},d=()=>i.current?.click(),g=()=>l.current?.click(),T=async h=>{if(h.target.files&&h.target.files[0]){const w=h.target.files[0];await j(w),h.target.value=""}},j=async h=>{q(!0),re("Menganalisis Struk...");try{const w=await xs(h);if(w)$(w),r&&r("Scan Berhasil! Data terisi.","success");else throw new Error("Empty response from AI")}catch(w){console.error("AI Scan Error:",w),w.message==="MISSING_API_KEY"?r&&r("API AI belum diatur.","error",{label:"Gunakan Offline OCR hanya kali ini",onClick:()=>D(h)}):r&&r(`Gagal memproses struk: ${w.message}`,"error")}finally{q(!1)}},D=async h=>{q(!0),re("Scanning Offline (Tesseract)...");try{const w=await hs(h);$(w),r&&r("Scan Offline Berhasil.","success")}catch(w){console.error("Offline Scan Error",w),r&&r(`Offline Scan Gagal: ${w.message}`,"error")}finally{q(!1)}},$=h=>{if(h.store_name&&f(h.store_name),h.transaction_date)try{const z=new Date(h.transaction_date);if(!isNaN(z.getTime())){const H=z.getFullYear(),ee=String(z.getMonth()+1).padStart(2,"0"),Re=String(z.getDate()).padStart(2,"0");N(`${H}-${ee}-${Re}T12:00`)}}catch{}const w=h.items;let P=[];w&&Array.isArray(w)&&w.length>0&&(P=w.map(z=>({id:Math.random().toString(36).substring(7),name:z.name||"Item",qty:Number(z.qty)||Number(z.quantity)||1,price:Number(z.price)||Number(z.unit_price)||0}))),h.shipping_cost>0&&P.push({id:Math.random().toString(36).substring(7),name:"Biaya Pengiriman",qty:1,price:Number(h.shipping_cost)}),h.service_fee>0&&P.push({id:Math.random().toString(36).substring(7),name:"Biaya Layanan",qty:1,price:Number(h.service_fee)}),h.shipping_discount>0&&P.push({id:Math.random().toString(36).substring(7),name:"Diskon Pengiriman",qty:1,price:-Math.abs(Number(h.shipping_discount))}),h.voucher_discount>0&&P.push({id:Math.random().toString(36).substring(7),name:"Diskon Voucher",qty:1,price:-Math.abs(Number(h.voucher_discount))}),P.length>0&&S(P),h.store_name&&G(h.store_name)},G=h=>{const w=(h||"").toLowerCase();let P=a.find(z=>z.type==="expense"&&w.includes(z.name.toLowerCase()));P&&Z(P.id)},Q=a.filter(h=>h.type===v),X=a.find(h=>h.id===K);return R?e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 w-full backdrop-blur-sm animate-ios-fade-in",children:e.jsxs("div",{className:"relative z-10 flex flex-col items-center p-6 text-center",children:[e.jsxs("div",{className:"relative w-20 h-20 mb-6",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-t-blue-500 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Ge,{className:"text-blue-400 animate-pulse",size:28})})]}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"AI Sedang Bekerja"}),e.jsx("p",{className:"text-gray-400 text-xs font-medium animate-pulse",children:M})]})}):e.jsxs("div",{className:"pt-safe min-h-screen pb-32 page-slide-up",children:[e.jsxs("div",{className:"px-4 py-4 md:py-8 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>n(-1),className:"p-2 -ml-2 rounded-full text-blue-500 hover:bg-blue-50 dark:hover:bg-white/10 ios-touch-target",children:e.jsxs("div",{className:"flex items-center gap-1 font-semibold text-sm",children:[e.jsx(xa,{size:22}),e.jsx("span",{children:"Kembali"})]})}),e.jsx("h1",{className:"text-lg font-bold text-black dark:text-white absolute left-1/2 transform -translate-x-1/2",children:t?"Edit Transaksi":o("add.title")}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"px-4 space-y-6 md:max-w-xl md:mx-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] p-1 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 flex",children:[e.jsx("button",{onClick:()=>U("expense"),className:`flex-1 py-2.5 text-xs font-bold rounded-xl transition-all flex items-center justify-center gap-2 ios-touch-target ${v==="expense"?"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:o("add.expense")}),e.jsx("button",{onClick:()=>U("income"),className:`flex-1 py-2.5 text-xs font-bold rounded-xl transition-all flex items-center justify-center gap-2 ios-touch-target ${v==="income"?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:o("add.income")})]}),v==="expense"&&!t&&e.jsxs("div",{className:"animate-slide-in-right",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wide",children:"Metode Input"}),e.jsxs("span",{className:"text-[10px] font-medium text-blue-500 flex items-center gap-1",children:[e.jsx(Ge,{size:10})," AI Support"]})]}),e.jsxs("div",{className:"flex gap-4 h-20",children:[e.jsxs("button",{onClick:d,className:"flex-1 bg-white dark:bg-[#1C1C1E] border border-gray-200 dark:border-white/10 rounded-[1.25rem] shadow-sm active:scale-95 transition-all flex flex-col items-center justify-center gap-1.5 group relative overflow-hidden",children:[e.jsx("div",{className:"w-7 h-7 bg-gray-50 dark:bg-white/5 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(vt,{size:16,className:"text-gray-600 dark:text-gray-300"})}),e.jsx("div",{className:"text-center z-10",children:e.jsx("span",{className:"block font-bold text-gray-900 dark:text-white text-[10px]",children:"Upload File"})})]}),e.jsxs("button",{onClick:g,className:"flex-1 bg-gradient-to-br from-blue-600 to-indigo-600 text-white rounded-[1.25rem] shadow-lg shadow-blue-500/25 active:scale-95 transition-all flex flex-col items-center justify-center gap-1.5 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-xl"}),e.jsx("div",{className:"w-7 h-7 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm group-hover:rotate-12 transition-transform",children:e.jsx(ha,{size:16,className:"text-white"})}),e.jsx("div",{className:"text-center z-10",children:e.jsx("span",{className:"block font-bold text-white text-[10px]",children:"Scan Kamera"})})]})]}),e.jsx("input",{type:"file",ref:i,className:"hidden",accept:"image/*,application/pdf",onChange:T}),e.jsx("input",{type:"file",ref:l,className:"hidden",accept:"image/*",capture:"environment",onChange:T})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] rounded-[2rem] p-6 shadow-sm border border-gray-100 dark:border-gray-800 animate-slide-in-right",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wide block mb-1.5",children:v==="income"?"Sumber Pemasukan":o("add.store")}),e.jsx("input",{type:"text",value:p,onChange:h=>f(h.target.value),placeholder:v==="income"?"e.g. Gaji Bulanan":"e.g. Starbucks",className:"w-full text-xl font-bold bg-transparent border-b border-gray-100 dark:border-gray-800 py-2 focus:outline-none focus:border-blue-500 dark:text-white placeholder-gray-300 transition-colors"})]}),v==="expense"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-end pb-2 border-b border-gray-100 dark:border-white/5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wide",children:o("add.items")}),e.jsxs("button",{onClick:ie,className:"text-blue-500 text-xs font-bold flex items-center gap-1 hover:bg-blue-50 dark:hover:bg-blue-900/20 px-2 py-1 rounded-lg transition-colors ios-touch-target",children:[e.jsx(be,{size:14})," ",o("add.addItem")]})]}),I.map((h,w)=>e.jsxs("div",{className:"bg-gray-50 dark:bg-white/5 p-4 rounded-2xl relative animate-slide-in-right",style:{animationDelay:`${w*.05}s`},children:[e.jsx("button",{onClick:()=>u(h.id),"aria-label":"Hapus item",className:"absolute top-3 right-3 text-red-400 hover:text-red-500 p-1 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 transition-all ios-touch-target",children:e.jsx(pe,{size:16})}),e.jsxs("label",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide block mb-1",children:["Item ",w+1]}),e.jsx("input",{className:"w-full bg-transparent text-base font-bold border-b border-gray-200 dark:border-white/10 py-1.5 mb-3 focus:outline-none focus:border-blue-500 dark:text-white placeholder-gray-300",placeholder:"Nama Barang",value:h.name,onChange:P=>te(h.id,"name",P.target.value)}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-[10px] text-gray-600 dark:text-gray-400 block mb-1",children:"Qty"}),e.jsx("input",{type:"number",className:"w-full bg-white dark:bg-black/20 rounded-xl p-2 font-bold text-center text-sm dark:text-white border border-transparent focus:border-blue-500 focus:outline-none shadow-sm",placeholder:"1",value:h.qty,onChange:P=>te(h.id,"qty",P.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-gray-600 dark:text-gray-400 block mb-1",children:"Harga Satuan"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-xs text-gray-400 font-bold",children:"Rp"}),e.jsx("input",{type:"number",className:`w-full bg-white dark:bg-black/20 rounded-xl py-2 pl-9 pr-3 text-sm font-bold dark:text-white focus:outline-none border border-transparent focus:border-blue-500 shadow-sm ${h.price<0?"text-red-500":""}`,placeholder:"0",value:h.price,onChange:P=>te(h.id,"price",P.target.value)})]})]})]})]},h.id))]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wide block mb-1.5",children:"Jumlah Pemasukan"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-3.5 text-lg text-gray-400 font-bold",children:"Rp"}),e.jsx("input",{type:"number",inputMode:"numeric",value:k,onChange:h=>x(h.target.value),className:"w-full bg-gray-50 dark:bg-black/20 text-3xl font-black rounded-2xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-green-500/50 dark:text-white placeholder-gray-200 transition-all border border-gray-100 dark:border-white/5 text-green-600 dark:text-green-400",placeholder:"0"})]})]})}),e.jsxs("div",{className:"mt-8 pt-4 border-t border-dashed border-gray-200 dark:border-gray-800 flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-500 text-xs uppercase tracking-wide",children:o("add.total")}),e.jsxs("span",{className:`text-2xl font-black tracking-tight ${v==="income"?"text-green-600":"text-red-600"}`,children:["Rp ",V.toLocaleString("id-ID")]})]})]}),e.jsx("div",{className:"bg-white dark:bg-[#1C1C1E] rounded-[2rem] p-1 shadow-sm border border-gray-100 dark:border-gray-800 animate-slide-in-right",style:{animationDelay:"0.2s"},children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-5 border-b md:border-b-0 md:border-r border-gray-100 dark:border-gray-800",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 uppercase block mb-1.5",children:o("add.date")}),e.jsx("input",{type:"datetime-local",value:b,onChange:h=>N(h.target.value),className:"w-full bg-transparent font-bold text-sm focus:outline-none dark:text-white p-1"})]}),e.jsxs("div",{className:"flex-1 p-5 cursor-pointer hover:bg-gray-50 dark:hover:bg-white/5 transition-colors rounded-b-[2rem] md:rounded-bl-none md:rounded-r-[2rem] ios-touch-target",onClick:()=>B(!0),children:[e.jsx("label",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 uppercase block mb-1.5",children:o("add.category")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg",children:X.icon}),e.jsx("span",{className:"font-bold text-sm dark:text-white",children:X.name})]}):e.jsx("span",{className:"font-bold text-sm text-gray-400",children:"Pilih Kategori"})}),e.jsx(St,{size:16,className:"text-gray-400"})]})]})]})}),e.jsx("button",{onClick:C,disabled:V===0||!p||F,className:`w-full text-white py-3.5 rounded-[1.5rem] font-bold text-base shadow-xl ios-touch-target disabled:opacity-50 disabled:grayscale flex items-center justify-center gap-2 mb-10 ${v==="income"?"bg-green-600 shadow-green-500/20 hover:bg-green-700":"bg-blue-600 shadow-blue-500/20 hover:bg-blue-700"}`,children:F?e.jsx("span",{className:"animate-pulse",children:t?"Memperbarui...":o("add.saving")}):e.jsx(e.Fragment,{children:t?"Perbarui Transaksi":o("add.save")})})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm animate-fade-in",onClick:()=>B(!1)}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white dark:bg-[#1C1C1E] rounded-t-[2rem] shadow-2xl animate-ios-slide-up flex flex-col max-h-[75vh]",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-1",onClick:()=>B(!1),children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-gray-300 dark:bg-gray-600"})}),e.jsxs("div",{className:"px-6 py-4 flex justify-between items-center border-b border-gray-100 dark:border-white/5",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ua,{size:18}),"Pilih Kategori"]}),e.jsx("button",{onClick:()=>B(!1),"aria-label":"Tutup",className:"bg-gray-100 dark:bg-white/10 p-2 rounded-full ios-touch-target",children:e.jsx(ye,{size:16,className:"text-gray-500 dark:text-gray-300"})})]}),e.jsx("div",{className:"overflow-y-auto p-4 space-y-2 pb-safe",children:Q.length>0?Q.map(h=>{const w=h.id===K;return e.jsxs("button",{onClick:()=>{Z(h.id),B(!1)},className:`w-full flex items-center justify-between p-4 rounded-2xl transition-all ios-touch-target border ${w?"bg-primary/10 border-primary text-primary":"bg-gray-50 dark:bg-white/5 border-transparent text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-white/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsx("span",{className:`font-bold text-sm ${w?"text-primary":""}`,children:h.name})]}),w&&e.jsx("div",{className:"bg-primary text-white p-1 rounded-full",children:e.jsx(qe,{size:14,strokeWidth:3})})]},h.id)}):e.jsxs("div",{className:"text-center py-10 text-gray-400",children:[e.jsx("p",{className:"text-sm font-medium",children:"Tidak ada kategori tersedia."}),e.jsx("p",{className:"text-xs mt-1",children:"Tambahkan di menu Settings."})]})})]})]})]})},Ae=["#007AFF","#34C759","#FF9500","#AF52DE","#FF2D55","#5856D6","#FF3B30","#8E8E93"],us=({transactions:a,user:s})=>{const{t:r}=ge(),[t,n]=m.useState(!1),[o,i]=m.useState(""),[l,y]=m.useState(!1),p=a.filter(x=>x.type==="expense"),f=p.reduce((x,b)=>x+b.totalAmount,0),I=p.reduce((x,b)=>(x[b.category]=(x[b.category]||0)+b.totalAmount,x),{}),S=Object.keys(I).map(x=>({name:x,value:I[x]})).sort((x,b)=>b.value-x.value),k=async()=>{if(n(!0),!o){y(!0);const x=await ms(a,s.name);i(x),y(!1)}};return e.jsxs("div",{className:"pt-safe min-h-screen page-transition pb-32",children:[e.jsx("div",{className:"px-6 py-6 pb-2",children:e.jsx("h1",{className:"text-2xl font-extrabold text-black dark:text-white tracking-tight",children:r("stats.title")})}),e.jsxs("div",{className:"px-4 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-[1.5rem] p-5 text-white shadow-lg shadow-indigo-500/25 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/10",children:e.jsx(Ct,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg leading-tight",children:r("stats.advisor.btn")}),e.jsx("p",{className:"text-indigo-100 text-xs font-medium opacity-90",children:r("stats.advisor.desc")})]})]}),t?e.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/10 animate-fade-in",children:l?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium animate-pulse",children:"Sedang menganalisis data keuanganmu..."})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-xs font-bold uppercase tracking-wider opacity-70",children:"Saran AI:"}),e.jsx("button",{onClick:()=>n(!1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(ye,{size:14})})]}),e.jsx("p",{className:"text-sm font-medium leading-relaxed",children:o})]})}):e.jsxs("button",{onClick:k,className:"w-full bg-white text-indigo-600 py-3 rounded-xl font-bold text-sm shadow-sm hover:bg-indigo-50 active:scale-95 transition-all flex items-center justify-center gap-2",children:[e.jsx(Ge,{size:16}),"Minta Analisis AI"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] rounded-[2rem] p-6 shadow-sm border border-gray-100 dark:border-white/5",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[e.jsx(Fe,{size:16,className:"text-primary"}),r("stats.dist")]}),S.length>0?e.jsxs("div",{className:"h-64 w-full relative",children:[e.jsx(It,{width:"100%",height:"100%",children:e.jsxs(_a,{children:[e.jsx(Ua,{data:S,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:S.map((x,b)=>e.jsx($a,{fill:Ae[b%Ae.length],strokeWidth:0},`cell-${b}`))}),e.jsx(Et,{formatter:x=>`Rp ${x.toLocaleString("id-ID")}`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"12px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",fontSize:"12px",fontWeight:"bold"}})]})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest mb-0.5",children:"Total"}),e.jsx("span",{className:"text-lg font-black text-gray-900 dark:text-white",children:f>=1e6?`${(f/1e6).toFixed(1)}Jt`:`${(f/1e3).toFixed(0)}K`})]})]}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-gray-400",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-3",children:e.jsx(Je,{size:24,className:"opacity-50"})}),e.jsx("p",{className:"text-xs font-medium",children:r("stats.noData")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wide ml-2",children:r("stats.details")}),S.map((x,b)=>e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] p-4 rounded-2xl flex items-center justify-between border border-gray-100 dark:border-white/5 shadow-sm ios-touch-target",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Ae[b%Ae.length]}}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-white",children:x.name}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:["(",(x.value/f*100).toFixed(1),"%)"]})]}),e.jsxs("span",{className:"font-bold text-sm text-gray-900 dark:text-white",children:["Rp ",x.value.toLocaleString("id-ID")]})]},x.name))]})]})]})};var ps=Ma();const fs=yt(ps),ne=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a),Te=a=>new Date(a).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),Le={toExcel:async(a,s,r)=>{const t=new fs.Workbook,n=t.addWorksheet("Laporan Keuangan"),o=a.filter(N=>N.type==="income"),i=a.filter(N=>N.type==="expense"),l=["Tanggal","Tempat/Toko","Kategori","Jumlah","Rincian Item"],y=N=>[Te(N.date),N.storeName,N.category,N.totalAmount,N.items.map(v=>`${v.qty}x ${v.name}`).join(", ")],p=o.reduce((N,v)=>N+v.totalAmount,0),f=i.reduce((N,v)=>N+v.totalAmount,0),I=p-f;n.addRow([`EZFin Report: ${r}`]),n.addRow([`User: ${s.name}`]),n.addRow([]),n.addRow(["PEMASUKAN (INCOME)"]),n.addRow(l),o.length>0?o.forEach(N=>n.addRow(y(N))):n.addRow(["(Tidak ada data pemasukan)"]),n.addRow([]),n.addRow(["PENGELUARAN (EXPENSE)"]),n.addRow(l),i.length>0?i.forEach(N=>n.addRow(y(N))):n.addRow(["(Tidak ada data pengeluaran)"]),n.addRow([]),n.addRow(["RINGKASAN (SUMMARY)"]),n.addRow(["Total Pemasukan",p]),n.addRow(["Total Pengeluaran",f]),n.addRow(["UNTUNG / RUGI",I]),n.columns=[{width:25},{width:20},{width:15},{width:15},{width:40}];const S={font:{bold:!0},fill:{fgColor:{argb:"FFE0E0E0"}}};[4,6+o.length+2,6+o.length+2+i.length+2].forEach(N=>{n.getRow(N).eachCell(v=>{v.font=S.font,v.fill=S.fill})});const k=await t.xlsx.writeBuffer(),x=new Blob([k],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=document.createElement("a");b.href=URL.createObjectURL(x),b.download=`EZFin_Report_${s.name.split(" ")[0]}_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(b),b.click(),document.body.removeChild(b)},toPDF:(a,s,r)=>{const t=new La({orientation:"p",unit:"mm",format:"a4"}),n=a.filter(f=>f.type==="income"),o=a.filter(f=>f.type==="expense"),i=n.reduce((f,I)=>f+I.totalAmount,0),l=o.reduce((f,I)=>f+I.totalAmount,0),y=i-l;t.setFontSize(18),t.setTextColor(0,122,255),t.text("Laporan Keuangan EZFin",14,20),t.setFontSize(10),t.setTextColor(60),t.text(`Periode: ${r}`,14,27),t.text(`Dibuat oleh: ${s.name}`,14,32);let p=40;t.setFontSize(12),t.setTextColor(0,0,0),t.text("1. PEMASUKAN",14,p),n.length>0?(gt(t,{startY:p+3,head:[["Tanggal","Sumber","Kategori","Jumlah"]],body:n.map(f=>[Te(f.date),f.storeName,f.category,ne(f.totalAmount)]),headStyles:{fillColor:[34,197,94]},styles:{fontSize:9}}),p=t.lastAutoTable.finalY+15):(t.setFontSize(10),t.setTextColor(150),t.text("(Tidak ada data pemasukan)",14,p+8),p+=20),t.setFontSize(12),t.setTextColor(0,0,0),t.text("2. PENGELUARAN",14,p),o.length>0?(gt(t,{startY:p+3,head:[["Tanggal","Toko/Tempat","Kategori","Jumlah"]],body:o.map(f=>[Te(f.date),f.storeName,f.category,ne(f.totalAmount)]),headStyles:{fillColor:[239,68,68]},styles:{fontSize:9}}),p=t.lastAutoTable.finalY+15):(t.setFontSize(10),t.setTextColor(150),t.text("(Tidak ada data pengeluaran)",14,p+8),p+=20),p>250&&(t.addPage(),p=20),t.setFillColor(245,247,250),t.rect(14,p,180,40,"F"),t.setFontSize(12),t.setTextColor(0),t.text("RINGKASAN AKHIR",20,p+10),t.setFontSize(10),t.text("Total Pemasukan:",20,p+20),t.text(ne(i),100,p+20),t.text("Total Pengeluaran:",20,p+26),t.text(ne(l),100,p+26),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("UNTUNG / RUGI:",20,p+35),t.setTextColor(y>=0?34:239,y>=0?197:68,y>=0?94:68),t.text(ne(y),100,p+35),t.save(`Laporan_EZFin_${new Date().toISOString().slice(0,10)}.pdf`)},toDocx:(a,s,r)=>{const t=a.filter(x=>x.type==="income"),n=a.filter(x=>x.type==="expense"),o=t.reduce((x,b)=>x+b.totalAmount,0),i=n.reduce((x,b)=>x+b.totalAmount,0),l=o-i,y=Ne(s.name),p=Ne(r),f=(x,b)=>x.length===0?"<p><i>Tidak ada data.</i></p>":`
        <table>
          <thead>
            <tr>
              <th style="background-color:${b}">Tanggal</th>
              <th style="background-color:${b}">Keterangan</th>
              <th style="background-color:${b}">Kategori</th>
              <th style="background-color:${b}" class="amount">Jumlah</th>
            </tr>
          </thead>
          <tbody>
            ${x.map(N=>`
              <tr>
                <td>${Te(N.date)}</td>
                <td>${Ne(N.storeName)} <br/><small>${Ne(N.items.map(v=>v.name).join(", "))}</small></td>
                <td>${Ne(N.category)}</td>
                <td class="amount">${ne(N.totalAmount)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>`,I=`
      <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
      <head>
        <meta charset="utf-8">
        <title>Laporan Keuangan</title>
        <style>
          body { font-family: 'Calibri', 'Arial', sans-serif; }
          h1, h2, h3 { color: #333; }
          table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 11pt; }
          th { color: white; }
          .amount { text-align: right; }
          .header { margin-bottom: 30px; border-bottom: 2px solid #007AFF; padding-bottom: 10px; }
          .summary-box { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; margin-top: 30px; }
          .profit { color: ${l>=0?"green":"red"}; font-weight: bold; font-size: 14pt; }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Laporan Keuangan EZFin</h1>
          <p><strong>User:</strong> ${y}</p>
          <p><strong>Periode:</strong> ${p}</p>
        </div>

        <h3>1. Pemasukan (Income)</h3>
        ${f(t,"#22c55e")}

        <h3>2. Pengeluaran (Expense)</h3>
        ${f(n,"#ef4444")}

        <div class="summary-box">
          <h3>Ringkasan Akhir</h3>
          <p>Total Pemasukan: <strong>${ne(o)}</strong></p>
          <p>Total Pengeluaran: <strong>${ne(i)}</strong></p>
          <hr/>
          <p>Untung / Rugi: <span class="profit">${ne(l)}</span></p>
        </div>
      </body>
      </html>
    `,S=new Blob(["\uFEFF",I],{type:"application/msword"}),k=document.createElement("a");k.href=URL.createObjectURL(S),k.download=`Laporan_EZFin_${new Date().toISOString().slice(0,10)}.doc`,document.body.appendChild(k),k.click(),document.body.removeChild(k)}},bs=["ðŸ’°","ðŸ’¸","ðŸ’³","ðŸ¦","ðŸ§¾","ðŸ’µ","ðŸ’Ž","âš–ï¸","ðŸ’¼","ðŸ“ˆ","ðŸ“‰","ðŸ“Ž","ðŸ’»","ðŸ“±","ðŸ–¨ï¸","ðŸ”","ðŸ•","ðŸœ","ðŸž","ðŸ¥©","ðŸ—","ðŸ°","â˜•","ðŸº","ðŸ½ï¸","ðŸ¥—","ðŸ£","ðŸ±","ðŸ¦","ðŸ¥¤","ðŸš—","ðŸš•","ðŸšŒ","ðŸš‘","ðŸš’","âœˆï¸","ðŸš€","â›½","ðŸš§","ðŸš¦","ðŸ›µ","ðŸš²","ðŸš‚","ðŸ›¥ï¸","ðŸ—ºï¸","ðŸ›ï¸","ðŸ‘—","ðŸ‘•","ðŸ‘–","ðŸ‘ ","ðŸ‘“","ðŸ’","ðŸŽ’","ðŸ§¢","ðŸ’„","ðŸ‘Ÿ","ðŸ“¦","ðŸŽ","ðŸ›’","ðŸ·ï¸","ðŸ ","ðŸ¢","ðŸ¥","ðŸ¨","ðŸš¿","ðŸ’¡","ðŸ”Œ","ðŸ§¯","ðŸ§¹","ðŸ§»","ðŸ›ï¸","ðŸ›‹ï¸","ðŸ›","ðŸ”‘","ðŸ”§","ðŸŽ®","ðŸŽ¬","ðŸŽ§","ðŸŽ¤","ðŸŽ¨","ðŸŽ³","ðŸŽ²","ðŸ§©","ðŸŽ«","ðŸŽª","ðŸ“š","âš½","ðŸ€","ðŸ‹ï¸","ðŸ§˜","ðŸ’Š","ðŸ©º","ðŸ¦·","ðŸ¶","ðŸ±","ðŸ‘¶","ðŸŽ‰","âœˆï¸","ðŸŽ“","ðŸ’’","â›ª","ðŸ•Œ","ðŸ™","â¤ï¸","â­"],ys=({title:a,icon:s,subtext:r,isOpen:t,onToggle:n,children:o})=>e.jsxs("div",{className:`bg-white dark:bg-[#1C1C1E] rounded-2xl overflow-hidden transition-all duration-300 border border-gray-100 dark:border-white/5 ${t?"shadow-lg ring-1 ring-black/5 dark:ring-white/10":"shadow-sm"}`,children:[e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between p-3.5 ios-touch-target",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl transition-colors duration-300 ${t?"bg-primary text-white":"bg-gray-50 dark:bg-white/10 text-gray-500 dark:text-gray-400"}`,children:e.jsx(s,{size:16,strokeWidth:2.5})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h2",{className:"font-bold text-xs text-gray-900 dark:text-white tracking-tight",children:a}),!t&&r&&e.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 mt-0.5 font-medium",children:r})]})]}),e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center transition-all duration-300 ${t?"bg-gray-100 dark:bg-white/10 rotate-180 text-primary":"text-gray-300 dark:text-gray-600"}`,children:e.jsx(St,{size:14,strokeWidth:3})})]}),t&&e.jsxs("div",{className:"px-3.5 pb-4 pt-0 animate-accordion-down origin-top",children:[e.jsx("div",{className:"h-px w-full bg-gray-100 dark:bg-white/5 mb-4"}),o]})]}),De=({title:a,isOpen:s,onClose:r,children:t})=>s?e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-md p-4 animate-ios-fade-in",children:[e.jsx("div",{className:"absolute inset-0",onClick:r}),e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] w-full max-w-md rounded-[1.5rem] p-5 shadow-2xl flex flex-col max-h-[85vh] page-slide-up relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 border-b border-gray-100 dark:border-white/5 pb-3",children:[e.jsx("h2",{className:"text-base font-bold text-gray-900 dark:text-white",children:a}),e.jsx("button",{onClick:r,className:"p-1.5 bg-gray-100 dark:bg-white/10 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 ios-touch-target",children:e.jsx(ye,{size:16})})]}),e.jsx("div",{className:"overflow-y-auto no-scrollbar pb-safe space-y-3",children:t})]})]}):null,ws=({user:a,categories:s,darkMode:r,themeColor:t,toggleTheme:n,setThemeColor:o,backgroundImage:i,setBackgroundImage:l,onAddCategory:y,onDeleteCategory:p,updateUser:f,onImportTransactions:I,onSyncSettings:S,addToast:k,onGoogleSessionError:x})=>{const{t:b,language:N,setLanguage:v}=ge(),[U,K]=m.useState(null),[Z,F]=m.useState(!1),[A,R]=m.useState(!1),[q,M]=m.useState(!1),[re,W]=m.useState(!1),[B,oe]=m.useState("expense"),[V,ie]=m.useState(""),[te,u]=m.useState("ðŸ“¦"),[C,d]=m.useState(""),[g,T]=m.useState(""),[j,D]=m.useState(""),[$,G]=m.useState(!1),[Q,X]=m.useState(!1),[h,w]=m.useState([]),[P,z]=m.useState(!1),[H,ee]=m.useState(!1),[Re,we]=m.useState(!1),[me,Ot]=m.useState("monthly"),[xe,ae]=m.useState(!1),[Ze,Ve]=m.useState([]),[_t,Pe]=m.useState(""),[Qe,ze]=m.useState([]),[he,Xe]=m.useState(null),[Ce,et]=m.useState(""),[le,Oe]=m.useState(Ft());m.useEffect(()=>{(async()=>{const E=await Y.getAllTransactions();w(E)})()},[]);const Ut=s.filter(c=>c.type===B),$t=c=>{K(U===c?null:c)},Mt=()=>{V&&(y({id:Math.random().toString(36).substr(2,9),name:V,icon:te,type:B}),ie(""),u("ðŸ“¦"))},Lt=()=>{if(C.length!==6){k("PIN must be 6 digits","error");return}T(""),G(!0)},Gt=async()=>{if(await fe(g)!==a.pin&&g!==a.pin){k("Wrong Old PIN","error");return}const E=await fe(C);f({pin:E}),d(""),G(!1),k("PIN Updated","success")},qt=async()=>{if(await fe(j)!==a.pin&&j!==a.pin){k("PIN Salah!","error");return}try{await Y.clearAllTransactions(),a.googleSheetId&&(k("Clearing Cloud Data...","info"),await O.clearAllData(a.googleSheetId)),k("Semua data berhasil direset.","success"),setTimeout(()=>{window.location.reload()},1500)}catch(E){console.error(E),k("Gagal mereset data.","error")}},Bt=c=>{const E=c.target.files?.[0];if(E&&l){if(E.size>2*1024*1024){k("Ukuran gambar maksimal 2MB","error");return}const L=new FileReader;L.onloadend=()=>{l(L.result)},L.readAsDataURL(E)}},Ht=(c,E)=>{const L=new Date;return c.filter(ke=>{const se=new Date(ke.date);switch(E){case"daily":return se.getDate()===L.getDate()&&se.getMonth()===L.getMonth()&&se.getFullYear()===L.getFullYear();case"weekly":{const at=new Date;return at.setDate(L.getDate()-7),se>=at&&se<=L}case"monthly":return se.getMonth()===L.getMonth()&&se.getFullYear()===L.getFullYear();case"yearly":return se.getFullYear()===L.getFullYear();default:return!0}})},_e=c=>{const E=Ht(h,me);if(E.length===0){k("Tidak ada data pada periode ini","info");return}let L="";const ke=new Date;me==="daily"?L=`Harian (${ke.toLocaleDateString("id-ID")})`:me==="weekly"?L="Mingguan (7 Hari Terakhir)":me==="monthly"?L=`Bulanan (${ke.toLocaleDateString("id-ID",{month:"long",year:"numeric"})})`:me==="yearly"&&(L=`Tahunan (${ke.getFullYear()})`);try{c==="excel"?Le.toExcel(E,a,L):c==="pdf"?Le.toPDF(E,a,L):c==="docx"&&Le.toDocx(E,a,L),k("Laporan berhasil diunduh","success"),z(!1)}catch(se){console.error(se),k("Gagal mengunduh laporan","error")}},Kt=async()=>{if(!O.isConfigured){k("System Error: Google Client ID is missing.","error");return}ae(!0);try{const c=await O.signIn(),E=await O.getUserInfo(c);if(f({googleEmail:E.email,googlePhotoUrl:E.picture}),k("Signed in successfully!","success"),!a.googleSheetId){const L=await O.searchSpreadsheets("EZFin");Ve(L||[]),ee(!0)}}catch(c){console.error(c),k("Failed to connect to Google.","error")}finally{ae(!1)}},tt=async()=>{ae(!0);try{const c=await O.searchSpreadsheets("EZFin");Ve(c||[]),ee(!0)}catch(c){c.message==="UNAUTHENTICATED"?x():k("Failed to fetch sheets","error")}finally{ae(!1)}},Yt=async c=>{if(Pe(c),c.length>2)try{const E=await O.searchFolders(c);ze(E||[])}catch(E){E.message==="UNAUTHENTICATED"&&x()}else ze([])},Wt=async()=>{if(!Ce.trim())return;ae(!0);const c=`EZFin Tracker - ${Ce.trim()}`;try{const E=await O.createSpreadsheet(c,he?.id);await S(E.id),f({googleSheetId:E.id,googleSheetName:E.name}),ee(!1),et(""),k("New Spreadsheet Created!","success")}catch(E){E.message==="UNAUTHENTICATED"?x():k("Failed to create sheet","error")}finally{ae(!1)}},Jt=async c=>{ae(!0);try{await S(c.id),f({googleSheetId:c.id,googleSheetName:c.name}),ee(!1),k("Spreadsheet Linked!","success")}catch(E){E.message==="UNAUTHENTICATED"?x():k("Failed to link spreadsheet","error")}finally{ae(!1)}},Zt=async()=>{if(a.googleSheetId){ae(!0);try{const c=await O.fetchTransactions(a.googleSheetId);I(c),await S(a.googleSheetId)}catch(c){console.error(c),c.message==="UNAUTHENTICATED"?x():k("Failed to import data.","error")}finally{ae(!1)}}},Vt=()=>{O.signOut(),f({googleSheetId:void 0,googleSheetName:void 0,googleEmail:void 0,googlePhotoUrl:void 0}),k("Google Account Disconnected","info")},Qt=()=>{cs(le),W(!1),k("AI Configuration Saved","success")};return e.jsxs("div",{className:"pt-safe min-h-screen page-transition pb-28 md:pb-10",children:[e.jsx("div",{className:"px-6 py-6 pb-2",children:e.jsx("h1",{className:"text-2xl font-extrabold text-black dark:text-white tracking-tight",children:b("set.title")})}),e.jsxs("div",{className:"p-4 space-y-3 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>z(!0),className:"flex flex-col items-center justify-center p-3 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 text-white shadow-lg shadow-emerald-500/20 ios-touch-target aspect-[16/10] relative overflow-hidden group border border-transparent",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-white/0 group-hover:bg-white/10 transition-colors"}),e.jsx("div",{className:"w-8 h-8 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mb-1.5 border border-white/10 group-active:scale-95 transition-transform",children:e.jsx(rt,{size:16})}),e.jsx("span",{className:"font-bold text-xs leading-none",children:b("set.export")}),e.jsx("span",{className:"text-[9px] opacity-80 font-medium mt-0.5",children:"PDF / Excel"})]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex flex-col items-center justify-center p-3 rounded-2xl bg-gradient-to-br from-red-500 to-pink-600 text-white shadow-lg shadow-red-500/20 ios-touch-target aspect-[16/10] relative overflow-hidden group border border-transparent",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-white/0 group-hover:bg-white/10 transition-colors"}),e.jsx("div",{className:"w-8 h-8 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mb-1.5 border border-white/10 group-active:scale-95 transition-transform",children:a.googleEmail?e.jsx(nt,{size:16}):e.jsx(ot,{size:16,className:"rotate-180"})}),e.jsx("span",{className:"font-bold text-xs leading-none",children:b("set.google")}),e.jsx("span",{className:"text-[9px] opacity-80 font-medium mt-0.5",children:a.googleEmail?"Connected":"Sync Data"})]}),e.jsxs("button",{onClick:()=>R(!0),className:"flex flex-col items-center justify-center p-3 rounded-2xl bg-white dark:bg-[#1C1C1E] border border-gray-100 dark:border-white/5 shadow-sm ios-touch-target aspect-[16/10] group hover:bg-gray-50 dark:hover:bg-white/5 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 dark:bg-white/10 rounded-full flex items-center justify-center mb-1.5 text-gray-600 dark:text-gray-300 group-active:scale-95 transition-transform",children:e.jsx(pa,{size:16})}),e.jsx("span",{className:"font-bold text-xs text-gray-900 dark:text-white leading-none",children:b("set.pref")}),e.jsx("span",{className:"text-[9px] text-gray-400 font-medium mt-0.5",children:"App Theme"})]}),e.jsxs("button",{onClick:()=>M(!0),className:"flex flex-col items-center justify-center p-3 rounded-2xl bg-white dark:bg-[#1C1C1E] border border-gray-100 dark:border-white/5 shadow-sm ios-touch-target aspect-[16/10] group hover:bg-gray-50 dark:hover:bg-white/5 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 dark:bg-white/10 rounded-full flex items-center justify-center mb-1.5 text-gray-600 dark:text-gray-300 group-active:scale-95 transition-transform",children:e.jsx(fa,{size:16})}),e.jsx("span",{className:"font-bold text-xs text-gray-900 dark:text-white leading-none",children:b("set.cats")}),e.jsx("span",{className:"text-[9px] text-gray-400 font-medium mt-0.5",children:"Edit Items"})]}),e.jsxs("button",{onClick:()=>W(!0),className:"col-span-2 flex flex-row items-center justify-between p-3 rounded-2xl bg-white dark:bg-[#1C1C1E] border border-gray-100 dark:border-white/5 shadow-sm ios-touch-target group hover:bg-gray-50 dark:hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center text-purple-600 dark:text-purple-400 group-active:scale-95 transition-transform",children:e.jsx(ba,{size:16})}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"font-bold text-xs text-gray-900 dark:text-white block leading-none",children:"Konfigurasi AI"}),e.jsx("span",{className:"text-[9px] text-gray-400 font-medium mt-0.5",children:"Atur Provider (OpenAI, Groq, dll)"})]})]}),e.jsx(it,{size:14,className:"text-gray-300 dark:text-gray-600"})]})]}),e.jsx(ys,{title:b("set.sec"),icon:ya,subtext:b("set.pin"),isOpen:U==="security",onToggle:()=>$t("security"),children:e.jsxs("div",{className:"flex flex-col items-center py-2 space-y-4",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center text-primary mb-2",children:e.jsx(wa,{size:18})}),e.jsx("h3",{className:"font-bold text-xs text-gray-900 dark:text-white mb-3 text-center",children:b("set.pin")}),e.jsx("input",{value:C,onChange:c=>{const E=c.target.value.replace(/[^0-9]/g,"");E.length<=6&&d(E)},type:"password",inputMode:"numeric",placeholder:"New 6-digit PIN",className:"w-full text-center text-base tracking-[0.5em] font-bold bg-gray-50 dark:bg-black/30 rounded-xl py-2.5 mb-3 focus:outline-none focus:ring-2 focus:ring-primary border border-gray-100 dark:border-white/10"}),e.jsx("button",{onClick:Lt,disabled:C.length!==6,className:"w-full bg-blue-600 text-white font-bold py-2.5 rounded-xl disabled:opacity-50 shadow-lg shadow-blue-500/30 ios-touch-target hover:bg-blue-700 transition-colors text-xs",children:b("set.updatePin")})]})}),e.jsx("div",{className:"w-full pt-4 border-t border-gray-100 dark:border-white/5",children:e.jsxs("button",{onClick:()=>{D(""),X(!0)},className:"w-full bg-red-50 dark:bg-red-900/10 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/20 py-2.5 rounded-xl font-bold flex items-center justify-center gap-2 transition-colors ios-touch-target text-xs border border-red-100 dark:border-red-900/30",children:[e.jsx(ka,{size:14}),"Reset Data Transaksi"]})})]})})]}),e.jsx(De,{title:b("set.google"),isOpen:Z,onClose:()=>F(!1),children:a.googleEmail?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-black/20 p-2.5 rounded-xl border border-gray-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:a.googlePhotoUrl||a.avatarUrl,className:"w-8 h-8 rounded-full border-2 border-white shadow-sm"}),e.jsxs("div",{className:"overflow-hidden text-left",children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-white text-xs truncate max-w-[150px]",children:a.googleEmail}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(qe,{size:10,className:"text-green-500"}),e.jsx("p",{className:"text-[9px] text-green-500 font-bold",children:"Linked"})]})]})]}),e.jsx("button",{onClick:Vt,"aria-label":"Disconnect Google",className:"p-2 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-lg hover:bg-red-100 transition-colors ios-touch-target",children:e.jsx(ot,{size:14})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[9px] font-bold text-gray-700 dark:text-gray-300 uppercase mb-2 ml-1 tracking-wider",children:b("set.sheet")}),a.googleSheetId?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-black/20 rounded-xl p-2.5 flex items-center justify-between border border-gray-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:"w-7 h-7 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg flex items-center justify-center shrink-0",children:e.jsx(Ie,{size:14})}),e.jsx("span",{className:"text-xs font-bold text-gray-900 dark:text-white truncate",children:a.googleSheetName})]}),e.jsx("button",{onClick:tt,className:"text-[9px] text-primary font-bold px-2 py-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg ios-touch-target",children:"Change"})]}),e.jsxs("button",{onClick:Zt,disabled:xe,className:"w-full bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 py-2.5 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors disabled:opacity-50 ios-touch-target text-xs",children:[xe?e.jsx(Ue,{className:"animate-spin",size:14}):e.jsx(rt,{size:14}),b("set.sync")]})]}):e.jsxs("button",{onClick:tt,className:"w-full border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl p-3 flex flex-col items-center justify-center text-gray-500 hover:border-primary hover:text-primary transition-all gap-1.5 bg-gray-50/50 dark:bg-white/5 ios-touch-target",children:[e.jsx(Ie,{size:20}),e.jsx("span",{className:"font-bold text-xs",children:"Select or Create Sheet"})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4 py-2",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-white/5 rounded-full flex items-center justify-center text-primary mb-1",children:e.jsx(nt,{size:24})}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 max-w-xs mx-auto leading-relaxed",children:b("set.backup.desc")}),e.jsxs("button",{onClick:Kt,disabled:xe,className:"w-full bg-blue-600 text-white py-2.5 rounded-xl font-bold shadow-lg shadow-blue-500/30 ios-touch-target flex items-center justify-center gap-2 disabled:opacity-50 disabled:grayscale hover:bg-blue-700 transition-colors text-xs",children:[xe?e.jsx(Ue,{className:"animate-spin",size:16}):e.jsx(it,{size:16}),b("set.signin")]})]})}),e.jsx(De,{title:b("set.pref"),isOpen:A,onClose:()=>R(!1),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 flex items-center justify-center",children:e.jsx(ja,{size:14})}),e.jsx("span",{className:"font-bold text-xs text-gray-900 dark:text-white",children:b("set.lang")})]}),e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 p-0.5 rounded-lg",children:[e.jsx("button",{onClick:()=>v("id"),className:`px-3 py-1 text-[10px] font-bold rounded-md transition-all ios-touch-target ${N==="id"?"bg-white dark:bg-gray-600 shadow-sm text-primary":"text-gray-500"}`,children:"ID"}),e.jsx("button",{onClick:()=>v("en"),className:`px-3 py-1 text-[10px] font-bold rounded-md transition-all ios-touch-target ${N==="en"?"bg-white dark:bg-gray-600 shadow-sm text-primary":"text-gray-500"}`,children:"EN"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 flex items-center justify-center",children:e.jsx(Na,{size:14,fill:"currentColor"})}),e.jsx("span",{className:"font-bold text-xs text-gray-900 dark:text-white",children:b("set.dark")})]}),e.jsx("button",{onClick:n,"aria-label":"Toggle Theme",className:`w-10 h-6 rounded-full transition-colors duration-300 relative ios-touch-target ${r?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}`,children:e.jsx("div",{className:`absolute top-1 left-1 w-4 h-4 bg-white rounded-full shadow-md transition-transform duration-300 ${r?"translate-x-4":""}`})})]}),e.jsxs("div",{className:"p-1.5 border-t border-gray-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-pink-100 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400 flex items-center justify-center",children:e.jsx(va,{size:14})}),e.jsx("span",{className:"font-bold text-xs text-gray-900 dark:text-white",children:"Theme Accent"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-1 px-1",children:Be.map(c=>e.jsx("button",{onClick:()=>o(c.id),"aria-label":`Select ${c.name} theme`,className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 border-2 transition-all ios-touch-target ${t===c.id?"border-gray-900 dark:border-white scale-110 shadow-sm":"border-transparent hover:scale-105"}`,style:{backgroundColor:c.hex},children:t===c.id&&e.jsx(qe,{size:12,className:"text-white",strokeWidth:3})},c.id))})]}),l&&e.jsxs("div",{className:"p-1.5 border-t border-gray-100 dark:border-white/5 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 flex items-center justify-center",children:e.jsx(Sa,{size:14})}),e.jsx("span",{className:"font-bold text-xs text-gray-900 dark:text-white",children:"Background Image"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[i&&e.jsxs("div",{className:"relative h-24 w-full rounded-xl overflow-hidden shadow-sm group",children:[e.jsx("img",{src:i,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>l(null),className:"bg-red-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold shadow-md hover:bg-red-600 transition-colors",children:"Hapus"})})]}),e.jsxs("label",{className:"flex items-center justify-center w-full border-2 border-dashed border-gray-200 dark:border-white/10 rounded-xl p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(vt,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-[9px] font-bold text-gray-500",children:"Upload Image (Blurry)"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Bt})]})]})]})]})}),e.jsxs(De,{title:b("set.cats"),isOpen:q,onClose:()=>M(!1),children:[e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-xl p-1 mb-2",children:[e.jsx("button",{onClick:()=>oe("expense"),className:`flex-1 py-1.5 text-[10px] font-bold rounded-lg transition-all ios-touch-target ${B==="expense"?"bg-white dark:bg-gray-600 shadow-sm text-gray-900 dark:text-white":"text-gray-500"}`,children:b("add.expense")}),e.jsx("button",{onClick:()=>oe("income"),className:`flex-1 py-1.5 text-[10px] font-bold rounded-lg transition-all ios-touch-target ${B==="income"?"bg-white dark:bg-gray-600 shadow-sm text-gray-900 dark:text-white":"text-gray-500"}`,children:b("add.income")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-1 max-h-[50vh] overflow-y-auto no-scrollbar pr-1",children:Ut.map(c=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-gray-50 dark:hover:bg-white/5 rounded-lg group transition-colors border border-transparent hover:border-gray-100 dark:hover:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-base bg-white dark:bg-black/40 w-7 h-7 flex items-center justify-center rounded-lg shadow-sm border border-gray-100 dark:border-white/10",children:c.icon}),e.jsx("span",{className:"font-bold text-xs text-gray-700 dark:text-gray-200",children:c.name})]}),e.jsx("button",{onClick:()=>p(c.id),"aria-label":"Delete category",className:"text-gray-300 hover:text-red-500 p-1.5 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all ios-touch-target",children:e.jsx(pe,{size:14})})]},c.id))}),e.jsxs("div",{className:"mt-2 flex gap-2 pt-3 border-t border-gray-100 dark:border-gray-800",children:[e.jsx("button",{onClick:()=>we(!0),className:"w-9 h-9 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-white/10 flex items-center justify-center text-base hover:bg-gray-100 dark:hover:bg-white/10 transition-colors ios-touch-target",children:te}),e.jsx("input",{value:V,onChange:c=>ie(c.target.value),placeholder:"New Category...",className:"flex-1 px-3 bg-gray-50 dark:bg-gray-800 rounded-xl text-xs focus:outline-none focus:ring-2 focus:ring-primary font-medium dark:text-white border border-gray-100 dark:border-white/10"}),e.jsx("button",{onClick:Mt,"aria-label":"Add category",className:"w-9 h-9 bg-black dark:bg-white text-white dark:text-black rounded-xl flex items-center justify-center ios-touch-target shadow-md active:scale-95 transition-transform",children:e.jsx(be,{size:16})})]})]}),e.jsx(De,{title:"Konfigurasi AI",isOpen:re,onClose:()=>W(!1),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-xl border border-purple-100 dark:border-purple-500/20",children:e.jsx("p",{className:"text-[10px] text-purple-700 dark:text-purple-300 leading-relaxed font-medium",children:"Anda dapat menggunakan penyedia AI apa pun yang kompatibel dengan format OpenAI (seperti Groq, DeepSeek, OpenRouter, atau LocalAI)."})}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1.5 block flex items-center gap-1",children:[e.jsx(Ca,{size:12})," Base URL"]}),e.jsx("input",{value:le.baseUrl,onChange:c=>Oe({...le,baseUrl:c.target.value}),placeholder:"https://api.openai.com/v1",className:"w-full bg-gray-50 dark:bg-black/20 rounded-xl px-3 py-2.5 text-xs font-bold text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border border-gray-100 dark:border-white/10"}),e.jsxs("p",{className:"text-[9px] text-gray-400 mt-1 ml-1",children:["Contoh: ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"https://api.groq.com/openai/v1"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1.5 block flex items-center gap-1",children:[e.jsx(Ia,{size:12})," API Key"]}),e.jsx("input",{value:le.apiKey,onChange:c=>Oe({...le,apiKey:c.target.value}),type:"password",placeholder:"sk-...",className:"w-full bg-gray-50 dark:bg-black/20 rounded-xl px-3 py-2.5 text-xs font-bold text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border border-gray-100 dark:border-white/10"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1.5 block flex items-center gap-1",children:[e.jsx(Ct,{size:12})," Model Name"]}),e.jsx("input",{value:le.modelName,onChange:c=>Oe({...le,modelName:c.target.value}),placeholder:"gpt-4o",className:"w-full bg-gray-50 dark:bg-black/20 rounded-xl px-3 py-2.5 text-xs font-bold text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border border-gray-100 dark:border-white/10"})]}),e.jsx("button",{onClick:Qt,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-500/30 ios-touch-target hover:bg-blue-700 transition-colors text-xs mt-2",children:"Simpan Konfigurasi"})]})}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 w-full animate-ios-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] w-full max-w-xs p-6 rounded-[2rem] shadow-2xl animate-shake text-center page-slide-up",children:[e.jsx("h2",{className:"font-bold text-lg mb-2 text-gray-900 dark:text-white",children:"Verify Old PIN"}),e.jsx("p",{className:"text-xs text-gray-500 mb-6",children:"Please enter your current PIN to confirm."}),e.jsx("input",{autoFocus:!0,value:g,onChange:c=>{const E=c.target.value.replace(/[^0-9]/g,"");E.length<=6&&T(E)},type:"password",inputMode:"numeric",className:"w-full text-center text-xl tracking-[0.5em] bg-gray-100 dark:bg-gray-800 rounded-xl py-2.5 mb-6 focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>G(!1),className:"flex-1 py-2.5 bg-gray-100 dark:bg-gray-800 rounded-xl font-bold text-xs text-gray-600 dark:text-gray-300 ios-touch-target",children:b("common.cancel")}),e.jsx("button",{onClick:Gt,disabled:g.length!==6,className:"flex-1 py-2.5 bg-blue-600 text-white rounded-xl font-bold text-xs disabled:opacity-50 ios-touch-target",children:b("common.confirm")})]})]})}),Q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 w-full animate-ios-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] w-full max-w-xs p-6 rounded-[2rem] shadow-2xl animate-shake text-center page-slide-up border border-red-100 dark:border-red-900/30",children:[e.jsx("div",{className:"w-12 h-12 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(pe,{size:24})}),e.jsx("h2",{className:"font-bold text-lg mb-2 text-red-600 dark:text-red-500",children:"Hapus Semua Data?"}),e.jsx("p",{className:"text-xs text-gray-500 mb-6",children:"Masukkan PIN Anda untuk konfirmasi penghapusan seluruh data transaksi. Tindakan ini tidak dapat dibatalkan."}),e.jsx("input",{autoFocus:!0,value:j,onChange:c=>{const E=c.target.value.replace(/[^0-9]/g,"");E.length<=6&&D(E)},type:"password",inputMode:"numeric",placeholder:"Enter PIN",className:"w-full text-center text-xl tracking-[0.5em] bg-red-50 dark:bg-red-900/10 rounded-xl py-2.5 mb-6 focus:outline-none focus:ring-2 focus:ring-red-500 border border-red-100 dark:border-red-900/20"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>X(!1),className:"flex-1 py-2.5 bg-gray-100 dark:bg-gray-800 rounded-xl font-bold text-xs text-gray-600 dark:text-gray-300 ios-touch-target",children:b("common.cancel")}),e.jsx("button",{onClick:qt,disabled:j.length!==6,className:"flex-1 py-2.5 bg-red-500 text-white rounded-xl font-bold text-xs disabled:opacity-50 hover:bg-red-600 transition-colors ios-touch-target",children:"RESET"})]})]})}),P&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-md p-4 animate-ios-fade-in",children:[e.jsx("div",{className:"absolute inset-0",onClick:()=>z(!1)}),e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] w-full max-w-sm rounded-[2rem] p-6 shadow-2xl page-slide-up relative z-10",children:[e.jsx("h2",{className:"text-base font-bold text-center mb-1 dark:text-white",children:b("set.export")}),e.jsx("p",{className:"text-center text-xs text-gray-400 mb-5",children:"Pilih periode laporan"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-5",children:["daily","weekly","monthly","yearly"].map(c=>e.jsx("button",{onClick:()=>Ot(c),className:`py-1.5 px-1 rounded-xl text-[10px] font-bold transition-all border-2 ios-touch-target ${me===c?"border-primary bg-blue-50 dark:bg-blue-900/30 text-primary":"border-transparent bg-gray-100 dark:bg-gray-800 text-gray-500"}`,children:c==="daily"?"Hari Ini":c==="weekly"?"Minggu Ini":c==="monthly"?"Bulan Ini":"Tahun Ini"},c))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>_e("excel"),className:"w-full p-2.5 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 rounded-xl flex items-center gap-3 font-bold hover:bg-green-100 transition-colors ios-touch-target text-xs",children:[e.jsx(Ie,{size:16})," Excel (.xlsx)"]}),e.jsxs("button",{onClick:()=>_e("pdf"),className:"w-full p-2.5 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded-xl flex items-center gap-3 font-bold hover:bg-red-100 transition-colors ios-touch-target text-xs",children:[e.jsx(lt,{size:16})," PDF (.pdf)"]}),e.jsxs("button",{onClick:()=>_e("docx"),className:"w-full p-2.5 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-xl flex items-center gap-3 font-bold hover:bg-blue-100 transition-colors ios-touch-target text-xs",children:[e.jsx(lt,{size:16})," Word (.doc)"]})]}),e.jsx("button",{onClick:()=>z(!1),className:"mt-5 w-full py-2.5 bg-gray-100 dark:bg-gray-800 rounded-xl font-bold text-xs text-gray-600 dark:text-gray-400 ios-touch-target",children:b("common.cancel")})]})]}),H&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-md p-4 animate-ios-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] w-full max-w-md rounded-[2rem] p-6 shadow-2xl overflow-hidden flex flex-col max-h-[85vh] page-slide-up",children:[e.jsx("h2",{className:"text-base font-bold text-center mb-1 dark:text-white",children:"Setup Google Sheets"}),e.jsx("p",{className:"text-center text-xs text-gray-500 mb-5",children:"Choose where to save your data"}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Create New"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 dark:bg-black/20 p-2 rounded-xl border border-gray-100 dark:border-gray-800",children:[e.jsx(dt,{size:16,className:"text-gray-400 ml-1"}),e.jsx("input",{className:"w-full bg-transparent text-xs p-1 focus:outline-none dark:text-white",placeholder:b("set.searchFolder"),value:_t,onChange:c=>Yt(c.target.value)}),he&&e.jsxs("div",{className:"absolute right-2 bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-[10px] font-bold flex items-center gap-1",children:[he.name,e.jsx("button",{onClick:()=>{Xe(null),Pe("")},"aria-label":"Clear folder",children:e.jsx(pe,{size:10})})]})]}),Qe.length>0&&!he&&e.jsx("div",{className:"absolute top-full left-0 right-0 bg-white dark:bg-gray-800 shadow-xl rounded-xl mt-1 z-10 max-h-32 overflow-y-auto border border-gray-100 dark:border-gray-700",children:Qe.map(c=>e.jsxs("button",{onClick:()=>{Xe(c),ze([]),Pe("")},className:"w-full text-left px-4 py-2 text-xs hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2 dark:text-white ios-touch-target",children:[e.jsx(dt,{size:12})," ",c.name]},c.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 mb-1.5 block",children:"Filename"}),e.jsxs("div",{className:"flex items-center bg-gray-50 dark:bg-black/20 rounded-xl border border-gray-100 dark:border-gray-800 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-white/5 px-3 py-2.5 text-xs font-bold text-gray-500 dark:text-gray-400 border-r border-gray-200 dark:border-gray-700 select-none whitespace-nowrap",children:"EZFin Tracker -"}),e.jsx("input",{value:Ce,onChange:c=>et(c.target.value),placeholder:"Nama (e.g. Pribadi)",className:"flex-1 bg-transparent px-3 py-2.5 text-xs font-bold text-gray-900 dark:text-white focus:outline-none placeholder-gray-400 min-w-0"})]})]}),e.jsxs("button",{onClick:Wt,disabled:xe||!Ce.trim(),className:"w-full bg-blue-600 text-white py-2.5 rounded-xl font-bold shadow-lg shadow-blue-500/20 ios-touch-target transition-transform flex items-center justify-center gap-2 text-xs disabled:opacity-50 disabled:grayscale",children:[xe?e.jsx(Ue,{className:"animate-spin"}):e.jsx(be,{size:16}),"Create File ",he?`in "${he.name}"`:""]})]}),e.jsxs("div",{className:"relative flex py-1 items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"}),e.jsx("span",{className:"flex-shrink-0 mx-4 text-gray-500 dark:text-gray-400 text-[10px] font-bold",children:"OR SELECT EXISTING"}),e.jsx("div",{className:"flex-grow border-t border-gray-200 dark:border-gray-700"})]}),e.jsx("div",{className:"space-y-2",children:Ze.length===0?e.jsx("p",{className:"text-center text-xs text-gray-500 py-4",children:"No matching sheets found."}):Ze.map(c=>e.jsxs("button",{onClick:()=>Jt(c),className:"w-full text-left p-3 rounded-xl bg-gray-50 dark:bg-black/30 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors flex items-center gap-3 ios-touch-target",children:[e.jsx(Ie,{className:"text-green-600",size:18}),e.jsx("span",{className:"font-semibold text-xs truncate dark:text-white",children:c.name})]},c.id))})]}),e.jsx("button",{onClick:()=>ee(!1),className:"mt-4 text-gray-500 dark:text-gray-400 text-xs font-medium hover:text-gray-700 ios-touch-target",children:b("common.cancel")})]})}),Re&&e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm animate-fade-in",onClick:()=>we(!1)}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white dark:bg-[#1C1C1E] rounded-t-[2rem] sm:rounded-[2rem] shadow-2xl animate-ios-slide-up flex flex-col max-h-[75vh] m-0 sm:m-4",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-1 sm:hidden",onClick:()=>we(!1),children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-gray-300 dark:bg-gray-600"})}),e.jsxs("div",{className:"px-6 py-4 flex justify-between items-center border-b border-gray-100 dark:border-white/5",children:[e.jsxs("h2",{className:"text-base font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ea,{size:18,className:"text-yellow-500"}),"Pilih Ikon"]}),e.jsx("button",{onClick:()=>we(!1),"aria-label":"Tutup",className:"bg-gray-100 dark:bg-white/10 p-2 rounded-full ios-touch-target hover:bg-gray-200 dark:hover:bg-white/20 transition-colors",children:e.jsx(ye,{size:16,className:"text-gray-500 dark:text-gray-300"})})]}),e.jsx("div",{className:"overflow-y-auto p-4 pb-safe",children:e.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-8 gap-3",children:bs.map((c,E)=>e.jsx("button",{onClick:()=>{u(c),we(!1)},className:"w-full aspect-square flex items-center justify-center text-xl bg-gray-50 dark:bg-white/5 rounded-xl hover:bg-gray-200 dark:hover:bg-white/20 transition-all active:scale-95 ios-touch-target",children:c},E))})})]})]})]})},ks=({transactions:a,onDelete:s})=>{const{t:r}=ge(),t=He(),[n,o]=m.useState("all"),[i,l]=m.useState(""),[y,p]=m.useState(!1),[f,I]=m.useState(new Set),[S,k]=m.useState(!1),[x,b]=m.useState(null),N=a.filter(A=>n==="all"||A.type===n).filter(A=>A.storeName.toLowerCase().includes(i.toLowerCase())||A.category.toLowerCase().includes(i.toLowerCase())).sort((A,R)=>new Date(R.date).getTime()-new Date(A.date).getTime()),v=A=>{const R=new Date;return A.getDate()===R.getDate()&&A.getMonth()===R.getMonth()&&A.getFullYear()===R.getFullYear()},U={};N.forEach(A=>{const R=new Date(A.date);let q=R.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});v(R)&&(q="Today"),U[q]||(U[q]=[]),U[q].push(A)});const K=()=>{y?(p(!1),I(new Set)):p(!0)},Z=A=>{const R=new Set(f);R.has(A)?R.delete(A):R.add(A),I(R)},F=async()=>{x?(await s([x]),b(null)):f.size>0&&(await s(Array.from(f)),I(new Set),p(!1)),k(!1)};return e.jsxs("div",{className:"pt-safe min-h-screen page-transition",children:[e.jsxs("div",{className:"px-6 py-6 pb-2 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-extrabold text-black dark:text-white tracking-tight",children:r("hist.title")}),e.jsx("button",{onClick:K,className:`text-sm font-bold ios-touch-target px-3 py-1 rounded-full transition-colors ${y?"text-primary bg-blue-50 dark:bg-blue-900/20":"text-primary"}`,children:y?r("common.cancel"):"Pilih"})]}),!y&&e.jsxs("div",{className:"px-4 mb-4 animate-fade-in",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] rounded-2xl p-2.5 flex items-center shadow-sm mb-3 border border-gray-100 dark:border-white/5 transition-colors focus-within:ring-2 focus-within:ring-primary/20",children:[e.jsx(ct,{className:"text-gray-400 ml-2",size:16}),e.jsx("input",{value:i,onChange:A=>l(A.target.value),placeholder:r("hist.search"),className:"w-full bg-transparent border-none focus:outline-none px-3 text-sm dark:text-white h-full font-medium placeholder-gray-400"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-2",children:["all","expense","income"].map(A=>e.jsx("button",{onClick:()=>o(A),className:`px-4 py-1.5 rounded-full text-[10px] font-bold capitalize transition-all ios-touch-target ${n===A?"bg-primary text-white shadow-lg shadow-blue-500/20":"bg-white dark:bg-[#1C1C1E] text-gray-500 border border-gray-100 dark:border-white/5"}`,children:r(A==="all"?"hist.filter.all":A==="expense"?"add.expense":"add.income")},A))})]}),y&&e.jsx("div",{className:"px-6 mb-4 animate-slide-in-right",children:e.jsxs("p",{className:"text-sm font-semibold text-gray-500",children:[f.size," transaksi dipilih"]})}),e.jsxs("div",{className:"px-4 pb-32 space-y-5",children:[Object.entries(U).map(([A,R],q)=>e.jsxs("div",{className:"animate-slide-in-right",style:{animationDelay:`${q*.05}s`},children:[e.jsx("h2",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide ml-3 mb-2",children:A}),e.jsx("div",{className:"bg-white dark:bg-[#1C1C1E] rounded-[1.25rem] overflow-hidden shadow-sm border border-gray-100 dark:border-white/5",children:R.map((M,re)=>{const W=f.has(M.id);return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>{y?Z(M.id):t(`/edit/${M.id}`)},className:`p-3.5 flex items-center justify-between transition-all duration-300 ios-touch-target ${W?"bg-blue-50 dark:bg-blue-900/10":"active:bg-gray-50 dark:active:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden flex-1",children:[e.jsx("div",{className:`transition-all duration-300 overflow-hidden ${y?"w-6 opacity-100 mr-2":"w-0 opacity-0 mr-0"}`,children:W?e.jsx(Aa,{className:"text-primary fill-blue-100 dark:fill-blue-900",size:24}):e.jsx(Ta,{className:"text-gray-300 dark:text-gray-600",size:24})}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${M.type==="income"?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400"}`,children:M.type==="income"?e.jsx(Da,{size:16}):e.jsx(Fa,{size:16})}),e.jsxs("div",{className:"truncate flex-1 pr-2",children:[e.jsx("p",{className:`font-bold text-sm text-gray-900 dark:text-white leading-tight mb-0.5 truncate ${W?"text-primary dark:text-blue-400":""}`,children:M.storeName}),e.jsxs("p",{className:"text-[10px] text-gray-600 dark:text-gray-400 font-medium truncate",children:[M.category," â€¢ ",new Date(M.date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`font-bold text-sm whitespace-nowrap ${M.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[M.type==="income"?"+":"-"," ",M.totalAmount.toLocaleString("id-ID")]}),!y&&e.jsx("button",{onClick:B=>{B.stopPropagation(),b(M.id),k(!0)},"aria-label":"Delete transaction",className:"w-8 h-8 flex items-center justify-center rounded-full bg-red-50 dark:bg-red-900/20 text-red-400 hover:text-red-600 transition-colors ios-touch-target",children:e.jsx(pe,{size:14})})]})]}),re<R.length-1&&e.jsx("hr",{className:"border-gray-100 dark:border-white/5 ml-14"})]},M.id)})})]},A)),Object.keys(U).length===0&&e.jsxs("div",{className:"text-center py-20 text-gray-400 flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4",children:e.jsx(ct,{size:20,className:"opacity-50"})}),e.jsx("p",{className:"text-xs font-medium",children:r("hist.noFound")})]})]}),e.jsx("div",{className:`fixed bottom-36 md:bottom-10 left-0 right-0 p-6 transition-transform duration-500 z-[60] ${y&&f.size>0?"translate-y-0":"translate-y-[200%]"}`,children:e.jsxs("button",{onClick:()=>k(!0),className:"w-full max-w-md mx-auto bg-red-500 text-white shadow-xl shadow-red-500/30 rounded-2xl py-3.5 font-bold flex items-center justify-center gap-2 active:scale-95 transition-all ios-touch-target",children:[e.jsx(pe,{size:18}),"Hapus (",f.size,")"]})}),S&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 w-full animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#1C1C1E] w-full max-w-xs p-6 rounded-[2rem] shadow-2xl animate-shake text-center page-slide-up",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Je,{size:24})}),e.jsx("h2",{className:"font-bold text-lg mb-2 text-gray-900 dark:text-white",children:x?"Hapus Transaksi?":`Hapus ${f.size} Transaksi?`}),e.jsx("p",{className:"text-xs text-gray-500 mb-6 leading-relaxed",children:"Tindakan ini tidak dapat dibatalkan. Data akan dihapus dari penyimpanan lokal dan Google Sheets (jika terhubung)."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{k(!1),b(null)},className:"flex-1 py-3 bg-gray-100 dark:bg-gray-800 rounded-xl font-bold text-xs text-gray-600 dark:text-gray-300 ios-touch-target",children:r("common.cancel")}),e.jsx("button",{onClick:F,className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-bold text-xs hover:bg-red-600 transition-colors ios-touch-target",children:"Ya, Hapus"})]})]})})]})},js=({transactions:a,categories:s,onSave:r,addToast:t})=>{const{id:n}=sa(),o=a.find(i=>i.id===n);return o?e.jsx(Pt,{categories:s,onSave:r,addToast:t,initialData:o}):e.jsx(ra,{to:"/"})};function Ns(){const[s,r]=m.useState(!0),[t,n]=m.useState(()=>{const d=localStorage.getItem("ezfin_last_active");return d?Date.now()-parseInt(d,10)>18e5:!0}),[o,i]=m.useState(()=>localStorage.getItem("theme")==="dark"),[l,y]=m.useState(()=>localStorage.getItem("theme_color")||"blue"),[p,f]=m.useState(()=>localStorage.getItem("ezfin_bg_image")),I=d=>{d?localStorage.setItem("ezfin_bg_image",d):localStorage.removeItem("ezfin_bg_image"),f(d)},[S,k]=m.useState([]),[x,b]=m.useState(pt),[N,v]=m.useState([]),[U,K]=m.useState([]);m.useEffect(()=>{const d=()=>{localStorage.setItem("ezfin_last_active",Date.now().toString())};return window.addEventListener("mousedown",d),window.addEventListener("keydown",d),window.addEventListener("touchstart",d),window.addEventListener("scroll",d),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("keydown",d),window.removeEventListener("touchstart",d),window.removeEventListener("scroll",d)}},[]),m.useEffect(()=>{(async()=>{try{const{user:g,categories:T}=await Y.initDefaultsIfNeeded(pt),j=await Y.getAllTransactions();if(g.pin.length<64){console.log("Migrating Plain Text PIN to Hash...");const D=await fe(g.pin);g.pin=D,await Y.saveUser(g)}b(g),K(T),v(j),O.initClient(async D=>{if(D&&(console.log("Google Services Initialized"),O.hasValidSession)){const $=O.getToken();if($)try{console.log("Restoring User Session info...");const G=await O.getUserInfo($);b(Q=>{const X={...Q,googleEmail:G.email,googlePhotoUrl:G.picture};return Y.saveUser(X).catch(console.error),X}),console.log("Session restored: User logged in.")}catch(G){console.warn("Restored session invalid (expired)",G),R()}}})}catch(g){console.error("Failed to load data from DB",g),F("Gagal memuat database. Silakan refresh.","error")}finally{r(!1)}})()},[]),m.useEffect(()=>{!s&&!t&&x.googleSheetId&&(console.log("Secure Session Active: Triggering Auto Sync..."),setTimeout(()=>{W(x.googleSheetId)},500))},[s,t,x.googleSheetId]),m.useEffect(()=>{o?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[o]),m.useEffect(()=>{const d=Be.find(T=>T.id===l)||Be[0],g=T=>{const j=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(T);return j?`${parseInt(j[1],16)} ${parseInt(j[2],16)} ${parseInt(j[3],16)}`:"0 122 255"};document.documentElement.style.setProperty("--primary-color",g(d.hex)),localStorage.setItem("theme_color",l)},[l]);const Z=()=>{localStorage.setItem("ezfin_last_active",Date.now().toString()),n(!1)},F=(d,g="info",T)=>{const j=Math.random().toString(36).substring(7);k(D=>[...D,{id:j,message:d,type:g,action:T}])},A=d=>{k(g=>g.filter(T=>T.id!==d))},R=()=>{O.signOut(),b(d=>{if(!d.googleEmail)return d;const g={...d,googleEmail:void 0,googlePhotoUrl:void 0};return Y.saveUser(g).catch(console.error),F("Sesi Google berakhir. Mohon login ulang.","error"),g})},q=async d=>{try{await Y.addTransaction(d),v(g=>[d,...g]),!t&&x.googleSheetId?O.appendTransaction(x.googleSheetId,d).then(()=>F("Transaction saved & synced to Drive!","success")).catch(g=>{console.error("Sync Error"),g.message==="UNAUTHENTICATED"?R():F("Saved locally, but Google Sync failed.","info")}):F("Transaksi berhasil disimpan!","success")}catch(g){console.error(g),F("Gagal menyimpan transaksi ke database","error")}},M=async d=>{try{await Y.addTransaction(d),v(g=>g.map(T=>T.id===d.id?d:T)),!t&&x.googleSheetId?O.updateTransaction(x.googleSheetId,d).then(()=>F("Transaction updated & synced!","success")).catch(g=>{console.error("Sync Edit Error"),g.message==="UNAUTHENTICATED"?R():F("Updated locally, but Google Sync failed.","info")}):F("Transaksi berhasil diperbarui!","success")}catch(g){console.error(g),F("Gagal memperbarui transaksi","error")}},re=async d=>{try{await Y.bulkDeleteTransactions(d),v(g=>g.filter(T=>!d.includes(T.id))),!t&&x.googleSheetId?O.deleteTransactions(x.googleSheetId,d).then(()=>F(`${d.length} Transaction(s) deleted.`,"success")).catch(g=>{console.error("Delete Sync Error"),g.message==="UNAUTHENTICATED"?R():F("Deleted locally, but Cloud sync failed.","info")}):F("Transaksi berhasil dihapus!","success")}catch(g){console.error(g),F("Gagal menghapus transaksi","error")}},W=async d=>{try{await oe(d);const g=await O.fetchTransactions(d),T=new Set(g.map(D=>D.id)),j=N.filter(D=>!T.has(D.id));j.length>0&&(console.log(`Pushing ${j.length} missing transactions to cloud...`),await O.bulkAppendTransactions(d,j)),g.length>0&&await B(g)}catch(g){console.error("Auto Sync Failed"),(g.message==="UNAUTHENTICATED"||g.message==="Not logged in")&&R()}},B=async d=>{try{await Y.bulkAddTransactions(d),v(g=>{const T=new Set(g.map(D=>D.id)),j=d.filter(D=>!T.has(D.id));return j.length===0?g:[...j,...g].sort((D,$)=>new Date($.date).getTime()-new Date(D.date).getTime())})}catch(g){console.error(g),F("Failed to save imported data","error")}},oe=async(d,g=o,T=l)=>{try{const j=await O.fetchAppSettings(d);if(j){let D=!1;if(j.pin&&j.pin!==x.pin){let $=j.pin;$.length<64&&($=await fe($)),await V({pin:$}),D=!0}if(j.categories&&j.categories.length>0){for(const $ of j.categories)await Y.saveCategory($);K(j.categories),D=!0}return j.darkMode!==void 0&&j.darkMode!==g&&(i(j.darkMode),D=!0),j.themeColor&&j.themeColor!==T&&(y(j.themeColor),D=!0),!0}else return await O.saveAppSettings(d,x.pin,U,g,T),!1}catch(j){if(console.error("Settings Sync error"),j.message==="UNAUTHENTICATED")throw j;return!1}},V=async d=>{try{const g={...x,...d};await Y.saveUser(g),b(g),g.googleSheetId&&(d.pin||d.name)&&O.saveAppSettings(g.googleSheetId,g.pin,U,o,l).catch(console.error)}catch(g){console.error(g),F("Gagal memperbarui profil","error")}},ie=async d=>{try{await Y.saveCategory(d);const g=[...U,d];K(g),F("Kategori ditambahkan","success"),x.googleSheetId&&O.saveAppSettings(x.googleSheetId,x.pin,g,o,l).catch(console.error)}catch{F("Gagal simpan kategori","error")}},te=async d=>{try{await Y.deleteCategory(d);const g=U.filter(T=>T.id!==d);K(g),F("Kategori dihapus","success"),x.googleSheetId&&O.saveAppSettings(x.googleSheetId,x.pin,g,o,l).catch(console.error)}catch{F("Gagal hapus kategori","error")}},u=()=>{const d=!o;i(d),x.googleSheetId&&O.saveAppSettings(x.googleSheetId,x.pin,U,d,l).catch(console.error)},C=d=>{y(d),x.googleSheetId&&O.saveAppSettings(x.googleSheetId,x.pin,U,o,d).catch(console.error)};return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-[#F2F2F7] dark:bg-black",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("h2",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 tracking-wide",children:"EZFin Loading..."})]}):t?e.jsx(es,{correctPin:x.pin,onSuccess:Z}):e.jsx(Va,{children:e.jsx(ta,{children:e.jsxs("div",{className:`flex min-h-[100dvh] w-full text-gray-900 dark:text-gray-100 transition-colors duration-300 ${o?"dark":""} ${p?"":"bg-[#F2F2F7] dark:bg-black"}`,children:[p&&e.jsx("div",{className:"fixed inset-0 z-0 bg-cover bg-center pointer-events-none transition-all duration-700 ease-in-out",style:{backgroundImage:`url(${p})`,filter:"blur(12px)",opacity:.5}}),e.jsx(ts,{toasts:S,removeToast:A}),e.jsx("div",{className:"hidden md:flex md:flex-col z-20 sticky top-0 h-[100dvh]",children:e.jsx(Xa,{})}),e.jsxs("div",{className:"flex-1 flex flex-col relative z-10",children:[e.jsx("main",{className:"flex-1 w-full",children:e.jsx("div",{className:"pb-56 md:pb-8 md:p-8 max-w-[1600px] mx-auto w-full pt-safe",children:e.jsxs(aa,{children:[e.jsx(ue,{path:"/",element:e.jsx(is,{user:x,transactions:N,categories:U,onUpdateUser:V})}),e.jsx(ue,{path:"/add",element:e.jsx("div",{className:"md:max-w-2xl md:mx-auto",children:e.jsx(Pt,{categories:U,onSave:q,addToast:F})})}),e.jsx(ue,{path:"/edit/:id",element:e.jsx("div",{className:"md:max-w-2xl md:mx-auto",children:e.jsx(js,{transactions:N,categories:U,onSave:M,addToast:F})})}),e.jsx(ue,{path:"/history",element:e.jsx("div",{className:"md:max-w-4xl md:mx-auto",children:e.jsx(ks,{transactions:N,onDelete:re})})}),e.jsx(ue,{path:"/stats",element:e.jsx("div",{className:"md:max-w-4xl md:mx-auto",children:e.jsx(us,{transactions:N,user:x})})}),e.jsx(ue,{path:"/settings",element:e.jsx("div",{className:"md:max-w-3xl md:mx-auto",children:e.jsx(ws,{user:x,categories:U,darkMode:o,themeColor:l,toggleTheme:u,setThemeColor:C,backgroundImage:p,setBackgroundImage:I,onAddCategory:ie,onDeleteCategory:te,updateUser:V,onImportTransactions:B,onSyncSettings:d=>oe(d,o,l),addToast:F,onGoogleSessionError:R})})})]})})}),e.jsx("div",{className:"md:hidden",children:e.jsx(Qa,{})})]})]})})})}const zt=document.getElementById("root");if(!zt)throw new Error("Could not find root element to mount to");const vs=Ka.createRoot(zt);vs.render(e.jsx(na.StrictMode,{children:e.jsx(Ns,{})}));
